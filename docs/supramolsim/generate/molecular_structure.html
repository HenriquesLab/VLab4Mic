<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.0"/>
    <title>supramolsim.generate.molecular_structure API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../generate.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;supramolsim.generate</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MolecularStructureParser">MolecularStructureParser</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MolecularStructureParser.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.chain_builder">chain_builder</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.ch_builder_max_dist">ch_builder_max_dist</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.ppgen">ppgen</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.CIFdictionary">CIFdictionary</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.assembly_operations">assembly_operations</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.chains_dict">chains_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.assembly_refpt">assembly_refpt</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.assembly_atoms">assembly_atoms</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.num_assembly_atoms">num_assembly_atoms</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.store_atoms_assembly">store_atoms_assembly</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.assymetric_defined">assymetric_defined</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.label_targets">label_targets</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.label_normals">label_normals</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.plotting_params">plotting_params</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.scale">scale</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularStructureParser.axis">axis</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.initialise_parsers">initialise_parsers</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.build_structure">build_structure</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.generate_MMCIF_dictionary">generate_MMCIF_dictionary</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.get_atoms_infile">get_atoms_infile</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.generate_chains_sequences">generate_chains_sequences</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.generate_assemmbly_operations">generate_assemmbly_operations</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.generate_assembly_reference_point">generate_assembly_reference_point</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.set_axis_from_point">set_axis_from_point</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.set_axis_with_vector">set_axis_with_vector</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.get_atom_res_chains_assembly">get_atom_res_chains_assembly</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.gen_targets_by_atoms">gen_targets_by_atoms</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.gen_targets_by_sequence">gen_targets_by_sequence</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.gen_Targets">gen_Targets</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.get_target_coords">get_target_coords</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.get_target_normals">get_target_normals</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.get_target_colour">get_target_colour</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.set_labefficiency">set_labefficiency</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.show_target_labels">show_target_labels</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.show_assembly_atoms">show_assembly_atoms</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularStructureParser.create_instance_builder">create_instance_builder</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MolecularReplicates">MolecularReplicates</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MolecularReplicates.__init__">MolecularReplicates</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularReplicates.replicates">replicates</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularReplicates.label_names">label_names</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularReplicates.plotcolours">plotcolours</a>
                        </li>
                        <li>
                                <a class="variable" href="#MolecularReplicates.label_fluorophore">label_fluorophore</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularReplicates.add_label">add_label</a>
                        </li>
                        <li>
                                <a class="function" href="#MolecularReplicates.assign_normals2targets">assign_normals2targets</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#build_structure_cif">build_structure_cif</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../supramolsim.html">supramolsim</a><wbr>.<a href="./../generate.html">generate</a><wbr>.molecular_structure    </h1>

                
                        <input id="mod-molecular_structure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-molecular_structure-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">yaml</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">Bio.PDB</span> <span class="kn">import</span> <span class="n">PDBParser</span><span class="p">,</span> <span class="n">MMCIFParser</span><span class="p">,</span> <span class="n">PPBuilder</span><span class="p">,</span> <span class="n">CaPPBuilder</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">Bio.PDB.MMCIF2Dict</span> <span class="kn">import</span> <span class="n">MMCIF2Dict</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">..utils.transform</span> <span class="kn">import</span> <span class="n">cif_builder</span>  <span class="c1"># Verified</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">..utils.visualisation.matplotlib_plots</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">draw1nomral_segment</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">add_ax_scatter</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">draw_nomral_segments</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="p">)</span>  <span class="c1"># verified</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">from</span> <span class="nn">.labels</span> <span class="kn">import</span> <span class="n">Label</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">..utils.data_format.visualisation</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>    <span class="n">format_coordinates</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">set_colorplot</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="p">)</span>  <span class="c1"># verified</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span> <span class="nn">..utils.data_format.structural_format</span> <span class="kn">import</span> <span class="n">builder_format</span>  <span class="c1"># verified</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span> <span class="nn">..utils.transform.normals</span> <span class="kn">import</span> <span class="n">normals_by_scaling</span>  <span class="c1"># verified</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="k">class</span> <span class="nc">MolecularStructureParser</span><span class="p">:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">=</span> <span class="s2">&quot;CaPPBuilder&quot;</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_normals</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="c1"># label_targets is a dictionary contining coordinates and parameters</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="c1"># for each labelling used. Keys are the name of the label</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-10</span>  <span class="c1"># in meters</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="nf">_clear_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;labels cleared&quot;</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_normals</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="n">temp_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">initialise_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        Create molecular structure of the PDB/CIF based on</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">        its format and associated parameters.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing structure. This might take a few seconds...&quot;</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;PDB&quot;</span><span class="p">:</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">PDBParser</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;CIF&quot;</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">MMCIFParser</span><span class="p">()</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> is not a valid format. Valid options are PDB or CIF.&quot;</span><span class="p">)</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;PPBuilder&quot;</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">PPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;CaPPBuilder&quot;</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">CaPPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Structure object for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> format&quot;</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="c1"># BUILD STRUCTURE</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">build_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Building structure for: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">generate_MMCIF_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1"># generate the dictionary with all field parsed from CIF file</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="o">=</span> <span class="n">MMCIF2Dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">get_atoms_infile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        Obtain all atom coordinates written the PDB/CIF file.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        Only the asymmetric unit is parsed.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="c1"># get array is a method for the class vector of biopython.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="c1"># np.array(atom.get_vector()) does not return the coordinates from the vector</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">generate_chains_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        Constructs a dictionary with chain ids as keys and</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        each chain value contains the string of the</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">        peptide built using the specified self.chain_builder</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        When these chains are used for searching epitope sequences.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">seq_chains_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">seq_chains_dict</span><span class="p">[</span><span class="n">chain</span><span class="o">.</span><span class="n">get_id</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="o">=</span> <span class="n">seq_chains_dict</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="c1"># nchains = len(list(seq_chains_dict.keys()))</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="c1"># print(f&quot;file contains {nchains} chains&quot;)</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">generate_assemmbly_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">        Parse the rotation/translation operation needed to</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">        construct a molecular assembly from an asymmetric unit</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># check if already created</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_MMCIF_dictionary</span><span class="p">()</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="c1"># get to know how many transformations there are</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="n">transformation_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.id&quot;</span><span class="p">]</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="c1"># each element of the list is pair of matrix-vector needed to transform data</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="c1"># iterate over each of the transformations</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="n">assembly_transformations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">row1</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>            <span class="p">]</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>            <span class="n">row2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>            <span class="p">]</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>            <span class="n">row3</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="p">]</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">row3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="p">[</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                <span class="p">],</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">assembly_transformations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">vector</span><span class="p">])</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="n">struct_oper_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">,</span> <span class="n">assembly_transformations</span><span class="p">))</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="c1"># print(</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="c1">#    &quot;This model is defined with more than one symmetric transformation.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>            <span class="c1"># Will consider the assembly as assymetric defined&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>            <span class="c1"># )</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="c1"># when no assembly unit exist, there is only 1 transform expected</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="c1"># print(&quot;This model is defined with only one symmetric transformation&quot;)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="o">=</span> <span class="n">struct_oper_dictionary</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">generate_assembly_reference_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="sd">        Generate a reference point for the whole structure by</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="sd">        constructing a full assembly (transforming the assymetric unit)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="sd">        with the assembly operations if needed.</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        Then averaging all atoms including asymmetric partners if exist.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="c1"># this function could use a small portion of the atoms defined only</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">allatoms_defined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms_infile</span><span class="p">()</span>  <span class="c1"># Parse all atoms in file</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="c1"># print(</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="c1">#    &quot;Strcture is defined by assymetric units.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="c1"># Generating symmetry partners with the following transformations.&quot;</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="c1"># )</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="c1"># hardcoded: use only transforms with integers as id</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="n">assemblyatoms</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="n">assembly_reference_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">assemblyatoms</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>                <span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="c1"># define axis</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="c1"># print(&quot;Defining axis from rotations&quot;)</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="n">vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_axis_from_rotations</span><span class="p">()</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">(</span><span class="n">vect</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="c1"># print(</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="c1">#    &quot;Strcture is not defined by assymetric units. Using only atoms in file&quot;</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>            <span class="c1"># )</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                <span class="p">)</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">allatoms_defined</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">()</span>  <span class="c1"># default [0,0,1]</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">_get_assemblyatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">set_axis_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_defining_point</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">axis_defining_point</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="c1"># central axis definition</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">set_axis_with_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">vector</span><span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">_central_axis_from_rotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        Calculate the central axis orientation from the assembly operations</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">)):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">average</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">central_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="p">]</span>  <span class="c1"># central axis is the eigenvector that corresponds to the eigenvalue = 1</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="k">return</span> <span class="n">central_axis</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="c1"># Parsing atoms</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">_get_atom_res_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">resnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atomnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Parse the structure generated and return desired atoms coordinates</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">        defined with atom name, residue id and chain id.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="n">myatoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>                <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">chainnames</span><span class="p">:</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>                    <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>                        <span class="c1"># this conditional checks if the residue is</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                        <span class="c1"># defined in resname list</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">resnames</span><span class="p">:</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">atomnames</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                                    <span class="n">myatoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">())</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="nf">_get_site_specific</span><span class="p">(</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">chainnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">resnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atomnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="p">):</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        Parse the structure generated and return desired atoms coordinates</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        defined with atom name, residue id and chain id</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        It is intended to return only one position per chain</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        The position will be counted from the cosntructed chains so that</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        Is is heavily dependant of all the chain to be defined</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking in: </span><span class="si">{</span><span class="n">chainnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">resnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">atomnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="n">myatoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>                <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">chainnames</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>                    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>                    <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>                        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>                        <span class="c1"># this conditional checks if the residue is</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>                        <span class="c1"># defined in resname list</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                            <span class="sa">f</span><span class="s2">&quot;resname </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">get_resname</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                            <span class="sa">f</span><span class="s2">&quot;segid: </span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">get_segid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                        <span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>                        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">resnames</span> <span class="ow">and</span> <span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>                                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">atomnames</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>                                    <span class="n">myatoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">())</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>                                    <span class="nb">print</span><span class="p">(</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>                                        <span class="sa">f</span><span class="s2">&quot;site speficic found: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                                    <span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">))</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>    <span class="p">):</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">        Parse the structure return desired atoms coordinates</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        defined with atom name, residue id and chain id.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        Output has shape Nx3. N is number of atoms</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="n">list_of_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="c1"># chains in structure on which to look for</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="c1"># print(f&quot;Using chains {list_of_chains}&quot;)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_res_chain</span><span class="p">(</span><span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_site_specific</span><span class="p">(</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">position</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>            <span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="c1"># atom_res_chain only considers a signle asymmetric unit</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="c1"># if the CIF defines an assembly, the asymmetric partners</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="c1"># or atom_res_chain are generated as well</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>            <span class="c1"># print(&quot;Generating symmetry partners for atoms parsed&quot;)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="n">atom_res_chain_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">atom_res_chain</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="p">)</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>            <span class="k">return</span> <span class="n">atom_res_chain_assembly</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>            <span class="k">return</span> <span class="n">atom_res_chain</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">        defined as Direct labeling</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;residues&quot;</span><span class="p">],</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">],</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="c1"># label_dictionary = dict(</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="c1">#    coordinates=parsed,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="c1">#    labeling_efficiency=labeling_efficiency,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>        <span class="c1">#    fluorophore=fluorophore,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="c1"># )</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="n">parsed</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>            <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>    <span class="c1"># Parsing secuences</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobject</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        defined as Binding labeling.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        It takes the epitope sequence and search for it in all the chains.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        Only considers the first appearance of such sequence.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">        Keeps the atom coordinates form all residues in the sequence.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">        Returns a point coordinate calculated from that sequence:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            Default method is coordinate average</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="c1">#  only the first appearance of the epitope in every chain is retreived</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="c1">#  if a chain has more than one epitope, only the first one is returned</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">target_seq</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;target_sequence&quot;</span><span class="p">]</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">method</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;summary_method&quot;</span><span class="p">]</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for sequence: </span><span class="si">{</span><span class="n">target_seq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="n">epitopes_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                    <span class="k">for</span> <span class="n">residue</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))):</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                                <span class="n">coords_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                    <span class="n">epitopes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="c1"># print(len(epitopes_list))</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>        <span class="c1"># print(f&quot;Summarizing epitopes location with method {method}&quot;)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="n">summarised_epitopes</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">summarize_epitope_atoms</span><span class="p">(</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="n">epitopes_list</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>        <span class="p">)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating symmetry partners for epitopes parsed&quot;</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="n">epitopes_locations_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>                <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="p">)</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>                <span class="n">epitopes_locations_assembly</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>            <span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>            <span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>            <span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>            <span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="k">def</span> <span class="nf">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="p">):</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">label_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>            <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>  <span class="c1"># this makes the difference</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>            <span class="n">labeling_efficiency</span><span class="o">=</span><span class="n">labeling_efficiency</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>            <span class="n">fluorophore</span><span class="o">=</span><span class="n">fluorophore</span><span class="p">,</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>            <span class="n">normals</span><span class="o">=</span><span class="n">normals</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="k">return</span> <span class="n">label_dictionary</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="c1"># generate targets from label info</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="k">def</span> <span class="nf">gen_Targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>        <span class="c1"># call the generator depending on the target type</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Atom_residue&quot;</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_atoms</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="k">elif</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_sequence</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label type </span><span class="si">{</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span><span class="si">}</span><span class="s2"> is not a valid label&quot;</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>    <span class="k">def</span> <span class="nf">get_target_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">get_target_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>    <span class="k">def</span> <span class="nf">get_target_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;plotcolour&quot;</span><span class="p">]</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="nf">set_labefficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">newefficiency</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetname</span><span class="p">][</span><span class="s2">&quot;labeling_efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newefficiency</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>    <span class="c1"># visualisation</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">show_target_labels</span><span class="p">(</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="n">labelnames</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="n">with_assembly_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">reference_point</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="n">show_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="n">with_normals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>    <span class="p">):</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">labelnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="k">for</span> <span class="n">trgt</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>                <span class="k">if</span> <span class="n">with_normals</span><span class="p">:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>                    <span class="n">draw_nomral_segments</span><span class="p">(</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_target_normals</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>                        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_colour</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>                    <span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>                    <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>                        <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">trgt</span><span class="p">]</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>                        <span class="p">),</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>                    <span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">with_assembly_atoms</span><span class="p">:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>                <span class="n">ax</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>                <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>                    <span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>                <span class="p">),</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="k">if</span> <span class="n">reference_point</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference point at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>                <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reoriented&quot;</span><span class="p">,</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>                <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="k">if</span> <span class="n">show_axis</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="n">draw1nomral_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lenght</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>    <span class="k">def</span> <span class="nf">show_assembly_atoms</span><span class="p">(</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>    <span class="p">):</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>            <span class="n">ax</span><span class="p">,</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>            <span class="n">format_coordinates</span><span class="p">(</span><span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]),</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="nf">create_instance_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savingdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">        create a dictionary with the information from putative label sites</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">        with their associated normals and general parameters such as axis,</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">        reference point, etc.</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="n">targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="n">targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>                <span class="n">coordinates</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">],</span> <span class="n">normals</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>            <span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="n">instance_builder</span> <span class="o">=</span> <span class="n">builder_format</span><span class="p">(</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>            <span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="p">)</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="k">if</span> <span class="n">savingdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>                <span class="n">savingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">savingdir</span> <span class="o">+</span> <span class="s2">&quot;/instance_builder_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Builder saved in: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">instance_builder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>        <span class="k">return</span> <span class="n">instance_builder</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="k">class</span> <span class="nc">MolecularReplicates</span><span class="p">(</span><span class="n">MolecularStructureParser</span><span class="p">):</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbxinfo</span><span class="p">):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="n">MolecularStructureParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_parsers</span><span class="p">(</span><span class="n">pdbxinfo</span><span class="p">)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">replicates</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>    <span class="k">def</span> <span class="nf">add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gen_Targets</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_plotcolour</span><span class="p">()</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>    <span class="k">def</span> <span class="nf">assign_normals2targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assigning normals to targets with method: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>            <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                    <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                    <span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>                <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a><span class="k">def</span> <span class="nf">build_structure_cif</span><span class="p">(</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>    <span class="n">cif_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">struct_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cif_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">format_type</span><span class="o">=</span><span class="s2">&quot;CIF&quot;</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a><span class="p">):</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="sd">    Load and parse PDB/CIF file and build structure object.</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">    This generates the minimal object containing all atoms and</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">    associated infomration parsed ready to be accessed when labelling</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">    and displaying structure.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">    Input:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">        (string): absolute path of CIF</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">    Output:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">        (MolecularReplicates) Structure object</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>    <span class="n">structure_dictionary</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">cif_file</span><span class="p">,</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">struct_title</span><span class="p">,</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">format_type</span><span class="p">,</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="n">cif_id</span><span class="p">,</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>    <span class="p">}</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>    <span class="n">Molecularstructure</span> <span class="o">=</span> <span class="n">MolecularReplicates</span><span class="p">(</span><span class="n">structure_dictionary</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>    <span class="n">Molecularstructure</span><span class="o">.</span><span class="n">build_structure</span><span class="p">()</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>    <span class="k">return</span> <span class="n">Molecularstructure</span>
</span></pre></div>


            </section>
                <section id="MolecularStructureParser">
                            <input id="MolecularStructureParser-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MolecularStructureParser</span>:

                <label class="view-source-button" for="MolecularStructureParser-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser-28"><a href="#MolecularStructureParser-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">MolecularStructureParser</span><span class="p">:</span>
</span><span id="MolecularStructureParser-29"><a href="#MolecularStructureParser-29"><span class="linenos"> 29</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-30"><a href="#MolecularStructureParser-30"><span class="linenos"> 30</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MolecularStructureParser-31"><a href="#MolecularStructureParser-31"><span class="linenos"> 31</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">=</span> <span class="s2">&quot;CaPPBuilder&quot;</span>
</span><span id="MolecularStructureParser-32"><a href="#MolecularStructureParser-32"><span class="linenos"> 32</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="MolecularStructureParser-33"><a href="#MolecularStructureParser-33"><span class="linenos"> 33</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-34"><a href="#MolecularStructureParser-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-35"><a href="#MolecularStructureParser-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-36"><a href="#MolecularStructureParser-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-37"><a href="#MolecularStructureParser-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-38"><a href="#MolecularStructureParser-38"><span class="linenos"> 38</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-39"><a href="#MolecularStructureParser-39"><span class="linenos"> 39</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-40"><a href="#MolecularStructureParser-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MolecularStructureParser-41"><a href="#MolecularStructureParser-41"><span class="linenos"> 41</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-42"><a href="#MolecularStructureParser-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser-43"><a href="#MolecularStructureParser-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_normals</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-44"><a href="#MolecularStructureParser-44"><span class="linenos"> 44</span></a>        <span class="c1"># label_targets is a dictionary contining coordinates and parameters</span>
</span><span id="MolecularStructureParser-45"><a href="#MolecularStructureParser-45"><span class="linenos"> 45</span></a>        <span class="c1"># for each labelling used. Keys are the name of the label</span>
</span><span id="MolecularStructureParser-46"><a href="#MolecularStructureParser-46"><span class="linenos"> 46</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser-47"><a href="#MolecularStructureParser-47"><span class="linenos"> 47</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1e-10</span>  <span class="c1"># in meters</span>
</span><span id="MolecularStructureParser-48"><a href="#MolecularStructureParser-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="MolecularStructureParser-49"><a href="#MolecularStructureParser-49"><span class="linenos"> 49</span></a>
</span><span id="MolecularStructureParser-50"><a href="#MolecularStructureParser-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="nf">_clear_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-51"><a href="#MolecularStructureParser-51"><span class="linenos"> 51</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;labels cleared&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-52"><a href="#MolecularStructureParser-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser-53"><a href="#MolecularStructureParser-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_normals</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-54"><a href="#MolecularStructureParser-54"><span class="linenos"> 54</span></a>        <span class="n">temp_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-55"><a href="#MolecularStructureParser-55"><span class="linenos"> 55</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser-56"><a href="#MolecularStructureParser-56"><span class="linenos"> 56</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_</span>
</span><span id="MolecularStructureParser-57"><a href="#MolecularStructureParser-57"><span class="linenos"> 57</span></a>
</span><span id="MolecularStructureParser-58"><a href="#MolecularStructureParser-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">initialise_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MolecularStructureParser-59"><a href="#MolecularStructureParser-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-60"><a href="#MolecularStructureParser-60"><span class="linenos"> 60</span></a><span class="sd">        Create molecular structure of the PDB/CIF based on</span>
</span><span id="MolecularStructureParser-61"><a href="#MolecularStructureParser-61"><span class="linenos"> 61</span></a><span class="sd">        its format and associated parameters.</span>
</span><span id="MolecularStructureParser-62"><a href="#MolecularStructureParser-62"><span class="linenos"> 62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-63"><a href="#MolecularStructureParser-63"><span class="linenos"> 63</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing structure. This might take a few seconds...&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-64"><a href="#MolecularStructureParser-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-65"><a href="#MolecularStructureParser-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-66"><a href="#MolecularStructureParser-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-67"><a href="#MolecularStructureParser-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-68"><a href="#MolecularStructureParser-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;PDB&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-69"><a href="#MolecularStructureParser-69"><span class="linenos"> 69</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">PDBParser</span><span class="p">()</span>
</span><span id="MolecularStructureParser-70"><a href="#MolecularStructureParser-70"><span class="linenos"> 70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="MolecularStructureParser-71"><a href="#MolecularStructureParser-71"><span class="linenos"> 71</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;CIF&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-72"><a href="#MolecularStructureParser-72"><span class="linenos"> 72</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">MMCIFParser</span><span class="p">()</span>
</span><span id="MolecularStructureParser-73"><a href="#MolecularStructureParser-73"><span class="linenos"> 73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="MolecularStructureParser-74"><a href="#MolecularStructureParser-74"><span class="linenos"> 74</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-75"><a href="#MolecularStructureParser-75"><span class="linenos"> 75</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> is not a valid format. Valid options are PDB or CIF.&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-76"><a href="#MolecularStructureParser-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;PPBuilder&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-77"><a href="#MolecularStructureParser-77"><span class="linenos"> 77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">PPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span><span id="MolecularStructureParser-78"><a href="#MolecularStructureParser-78"><span class="linenos"> 78</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;CaPPBuilder&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-79"><a href="#MolecularStructureParser-79"><span class="linenos"> 79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">CaPPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span><span id="MolecularStructureParser-80"><a href="#MolecularStructureParser-80"><span class="linenos"> 80</span></a>
</span><span id="MolecularStructureParser-81"><a href="#MolecularStructureParser-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-82"><a href="#MolecularStructureParser-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Structure object for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> format&quot;</span>
</span><span id="MolecularStructureParser-83"><a href="#MolecularStructureParser-83"><span class="linenos"> 83</span></a>
</span><span id="MolecularStructureParser-84"><a href="#MolecularStructureParser-84"><span class="linenos"> 84</span></a>    <span class="c1"># BUILD STRUCTURE</span>
</span><span id="MolecularStructureParser-85"><a href="#MolecularStructureParser-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="nf">build_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-86"><a href="#MolecularStructureParser-86"><span class="linenos"> 86</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Building structure for: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-87"><a href="#MolecularStructureParser-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-88"><a href="#MolecularStructureParser-88"><span class="linenos"> 88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="MolecularStructureParser-89"><a href="#MolecularStructureParser-89"><span class="linenos"> 89</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-90"><a href="#MolecularStructureParser-90"><span class="linenos"> 90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser-91"><a href="#MolecularStructureParser-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-92"><a href="#MolecularStructureParser-92"><span class="linenos"> 92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span><span id="MolecularStructureParser-93"><a href="#MolecularStructureParser-93"><span class="linenos"> 93</span></a>
</span><span id="MolecularStructureParser-94"><a href="#MolecularStructureParser-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">generate_MMCIF_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-95"><a href="#MolecularStructureParser-95"><span class="linenos"> 95</span></a>        <span class="c1"># generate the dictionary with all field parsed from CIF file</span>
</span><span id="MolecularStructureParser-96"><a href="#MolecularStructureParser-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="o">=</span> <span class="n">MMCIF2Dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="MolecularStructureParser-97"><a href="#MolecularStructureParser-97"><span class="linenos"> 97</span></a>
</span><span id="MolecularStructureParser-98"><a href="#MolecularStructureParser-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">get_atoms_infile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-99"><a href="#MolecularStructureParser-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-100"><a href="#MolecularStructureParser-100"><span class="linenos">100</span></a><span class="sd">        Obtain all atom coordinates written the PDB/CIF file.</span>
</span><span id="MolecularStructureParser-101"><a href="#MolecularStructureParser-101"><span class="linenos">101</span></a><span class="sd">        Only the asymmetric unit is parsed.</span>
</span><span id="MolecularStructureParser-102"><a href="#MolecularStructureParser-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-103"><a href="#MolecularStructureParser-103"><span class="linenos">103</span></a>        <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-104"><a href="#MolecularStructureParser-104"><span class="linenos">104</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser-105"><a href="#MolecularStructureParser-105"><span class="linenos">105</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser-106"><a href="#MolecularStructureParser-106"><span class="linenos">106</span></a>                <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="MolecularStructureParser-107"><a href="#MolecularStructureParser-107"><span class="linenos">107</span></a>                    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser-108"><a href="#MolecularStructureParser-108"><span class="linenos">108</span></a>                        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="MolecularStructureParser-109"><a href="#MolecularStructureParser-109"><span class="linenos">109</span></a>        <span class="c1"># get array is a method for the class vector of biopython.</span>
</span><span id="MolecularStructureParser-110"><a href="#MolecularStructureParser-110"><span class="linenos">110</span></a>        <span class="c1"># np.array(atom.get_vector()) does not return the coordinates from the vector</span>
</span><span id="MolecularStructureParser-111"><a href="#MolecularStructureParser-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="MolecularStructureParser-112"><a href="#MolecularStructureParser-112"><span class="linenos">112</span></a>
</span><span id="MolecularStructureParser-113"><a href="#MolecularStructureParser-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">generate_chains_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-114"><a href="#MolecularStructureParser-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-115"><a href="#MolecularStructureParser-115"><span class="linenos">115</span></a><span class="sd">        Constructs a dictionary with chain ids as keys and</span>
</span><span id="MolecularStructureParser-116"><a href="#MolecularStructureParser-116"><span class="linenos">116</span></a><span class="sd">        each chain value contains the string of the</span>
</span><span id="MolecularStructureParser-117"><a href="#MolecularStructureParser-117"><span class="linenos">117</span></a><span class="sd">        peptide built using the specified self.chain_builder</span>
</span><span id="MolecularStructureParser-118"><a href="#MolecularStructureParser-118"><span class="linenos">118</span></a>
</span><span id="MolecularStructureParser-119"><a href="#MolecularStructureParser-119"><span class="linenos">119</span></a><span class="sd">        When these chains are used for searching epitope sequences.</span>
</span><span id="MolecularStructureParser-120"><a href="#MolecularStructureParser-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-121"><a href="#MolecularStructureParser-121"><span class="linenos">121</span></a>        <span class="n">seq_chains_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MolecularStructureParser-122"><a href="#MolecularStructureParser-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser-123"><a href="#MolecularStructureParser-123"><span class="linenos">123</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser-124"><a href="#MolecularStructureParser-124"><span class="linenos">124</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser-125"><a href="#MolecularStructureParser-125"><span class="linenos">125</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MolecularStructureParser-126"><a href="#MolecularStructureParser-126"><span class="linenos">126</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="MolecularStructureParser-127"><a href="#MolecularStructureParser-127"><span class="linenos">127</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="MolecularStructureParser-128"><a href="#MolecularStructureParser-128"><span class="linenos">128</span></a>                <span class="n">seq_chains_dict</span><span class="p">[</span><span class="n">chain</span><span class="o">.</span><span class="n">get_id</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="MolecularStructureParser-129"><a href="#MolecularStructureParser-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="o">=</span> <span class="n">seq_chains_dict</span>
</span><span id="MolecularStructureParser-130"><a href="#MolecularStructureParser-130"><span class="linenos">130</span></a>        <span class="c1"># nchains = len(list(seq_chains_dict.keys()))</span>
</span><span id="MolecularStructureParser-131"><a href="#MolecularStructureParser-131"><span class="linenos">131</span></a>        <span class="c1"># print(f&quot;file contains {nchains} chains&quot;)</span>
</span><span id="MolecularStructureParser-132"><a href="#MolecularStructureParser-132"><span class="linenos">132</span></a>
</span><span id="MolecularStructureParser-133"><a href="#MolecularStructureParser-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">generate_assemmbly_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-134"><a href="#MolecularStructureParser-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-135"><a href="#MolecularStructureParser-135"><span class="linenos">135</span></a><span class="sd">        Parse the rotation/translation operation needed to</span>
</span><span id="MolecularStructureParser-136"><a href="#MolecularStructureParser-136"><span class="linenos">136</span></a><span class="sd">        construct a molecular assembly from an asymmetric unit</span>
</span><span id="MolecularStructureParser-137"><a href="#MolecularStructureParser-137"><span class="linenos">137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-138"><a href="#MolecularStructureParser-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># check if already created</span>
</span><span id="MolecularStructureParser-139"><a href="#MolecularStructureParser-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_MMCIF_dictionary</span><span class="p">()</span>
</span><span id="MolecularStructureParser-140"><a href="#MolecularStructureParser-140"><span class="linenos">140</span></a>        <span class="c1"># get to know how many transformations there are</span>
</span><span id="MolecularStructureParser-141"><a href="#MolecularStructureParser-141"><span class="linenos">141</span></a>        <span class="n">transformation_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.id&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-142"><a href="#MolecularStructureParser-142"><span class="linenos">142</span></a>        <span class="c1"># each element of the list is pair of matrix-vector needed to transform data</span>
</span><span id="MolecularStructureParser-143"><a href="#MolecularStructureParser-143"><span class="linenos">143</span></a>        <span class="c1"># iterate over each of the transformations</span>
</span><span id="MolecularStructureParser-144"><a href="#MolecularStructureParser-144"><span class="linenos">144</span></a>        <span class="n">assembly_transformations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-145"><a href="#MolecularStructureParser-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)):</span>
</span><span id="MolecularStructureParser-146"><a href="#MolecularStructureParser-146"><span class="linenos">146</span></a>            <span class="n">row1</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser-147"><a href="#MolecularStructureParser-147"><span class="linenos">147</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-148"><a href="#MolecularStructureParser-148"><span class="linenos">148</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-149"><a href="#MolecularStructureParser-149"><span class="linenos">149</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-150"><a href="#MolecularStructureParser-150"><span class="linenos">150</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser-151"><a href="#MolecularStructureParser-151"><span class="linenos">151</span></a>
</span><span id="MolecularStructureParser-152"><a href="#MolecularStructureParser-152"><span class="linenos">152</span></a>            <span class="n">row2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser-153"><a href="#MolecularStructureParser-153"><span class="linenos">153</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-154"><a href="#MolecularStructureParser-154"><span class="linenos">154</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-155"><a href="#MolecularStructureParser-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-156"><a href="#MolecularStructureParser-156"><span class="linenos">156</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser-157"><a href="#MolecularStructureParser-157"><span class="linenos">157</span></a>
</span><span id="MolecularStructureParser-158"><a href="#MolecularStructureParser-158"><span class="linenos">158</span></a>            <span class="n">row3</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser-159"><a href="#MolecularStructureParser-159"><span class="linenos">159</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-160"><a href="#MolecularStructureParser-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-161"><a href="#MolecularStructureParser-161"><span class="linenos">161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-162"><a href="#MolecularStructureParser-162"><span class="linenos">162</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser-163"><a href="#MolecularStructureParser-163"><span class="linenos">163</span></a>            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">row3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-164"><a href="#MolecularStructureParser-164"><span class="linenos">164</span></a>
</span><span id="MolecularStructureParser-165"><a href="#MolecularStructureParser-165"><span class="linenos">165</span></a>            <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="MolecularStructureParser-166"><a href="#MolecularStructureParser-166"><span class="linenos">166</span></a>                <span class="p">[</span>
</span><span id="MolecularStructureParser-167"><a href="#MolecularStructureParser-167"><span class="linenos">167</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-168"><a href="#MolecularStructureParser-168"><span class="linenos">168</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-169"><a href="#MolecularStructureParser-169"><span class="linenos">169</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser-170"><a href="#MolecularStructureParser-170"><span class="linenos">170</span></a>                <span class="p">],</span>
</span><span id="MolecularStructureParser-171"><a href="#MolecularStructureParser-171"><span class="linenos">171</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser-172"><a href="#MolecularStructureParser-172"><span class="linenos">172</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-173"><a href="#MolecularStructureParser-173"><span class="linenos">173</span></a>            <span class="n">assembly_transformations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">vector</span><span class="p">])</span>
</span><span id="MolecularStructureParser-174"><a href="#MolecularStructureParser-174"><span class="linenos">174</span></a>        <span class="n">struct_oper_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">,</span> <span class="n">assembly_transformations</span><span class="p">))</span>
</span><span id="MolecularStructureParser-175"><a href="#MolecularStructureParser-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MolecularStructureParser-176"><a href="#MolecularStructureParser-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MolecularStructureParser-177"><a href="#MolecularStructureParser-177"><span class="linenos">177</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser-178"><a href="#MolecularStructureParser-178"><span class="linenos">178</span></a>            <span class="c1">#    &quot;This model is defined with more than one symmetric transformation.</span>
</span><span id="MolecularStructureParser-179"><a href="#MolecularStructureParser-179"><span class="linenos">179</span></a>            <span class="c1"># Will consider the assembly as assymetric defined&quot;</span>
</span><span id="MolecularStructureParser-180"><a href="#MolecularStructureParser-180"><span class="linenos">180</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser-181"><a href="#MolecularStructureParser-181"><span class="linenos">181</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-182"><a href="#MolecularStructureParser-182"><span class="linenos">182</span></a>            <span class="c1"># when no assembly unit exist, there is only 1 transform expected</span>
</span><span id="MolecularStructureParser-183"><a href="#MolecularStructureParser-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MolecularStructureParser-184"><a href="#MolecularStructureParser-184"><span class="linenos">184</span></a>            <span class="c1"># print(&quot;This model is defined with only one symmetric transformation&quot;)</span>
</span><span id="MolecularStructureParser-185"><a href="#MolecularStructureParser-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="o">=</span> <span class="n">struct_oper_dictionary</span>
</span><span id="MolecularStructureParser-186"><a href="#MolecularStructureParser-186"><span class="linenos">186</span></a>
</span><span id="MolecularStructureParser-187"><a href="#MolecularStructureParser-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">generate_assembly_reference_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-188"><a href="#MolecularStructureParser-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-189"><a href="#MolecularStructureParser-189"><span class="linenos">189</span></a><span class="sd">        Generate a reference point for the whole structure by</span>
</span><span id="MolecularStructureParser-190"><a href="#MolecularStructureParser-190"><span class="linenos">190</span></a><span class="sd">        constructing a full assembly (transforming the assymetric unit)</span>
</span><span id="MolecularStructureParser-191"><a href="#MolecularStructureParser-191"><span class="linenos">191</span></a><span class="sd">        with the assembly operations if needed.</span>
</span><span id="MolecularStructureParser-192"><a href="#MolecularStructureParser-192"><span class="linenos">192</span></a><span class="sd">        Then averaging all atoms including asymmetric partners if exist.</span>
</span><span id="MolecularStructureParser-193"><a href="#MolecularStructureParser-193"><span class="linenos">193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-194"><a href="#MolecularStructureParser-194"><span class="linenos">194</span></a>        <span class="c1"># this function could use a small portion of the atoms defined only</span>
</span><span id="MolecularStructureParser-195"><a href="#MolecularStructureParser-195"><span class="linenos">195</span></a>        <span class="n">allatoms_defined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms_infile</span><span class="p">()</span>  <span class="c1"># Parse all atoms in file</span>
</span><span id="MolecularStructureParser-196"><a href="#MolecularStructureParser-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-197"><a href="#MolecularStructureParser-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser-198"><a href="#MolecularStructureParser-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser-199"><a href="#MolecularStructureParser-199"><span class="linenos">199</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser-200"><a href="#MolecularStructureParser-200"><span class="linenos">200</span></a>            <span class="c1">#    &quot;Strcture is defined by assymetric units.</span>
</span><span id="MolecularStructureParser-201"><a href="#MolecularStructureParser-201"><span class="linenos">201</span></a>            <span class="c1"># Generating symmetry partners with the following transformations.&quot;</span>
</span><span id="MolecularStructureParser-202"><a href="#MolecularStructureParser-202"><span class="linenos">202</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser-203"><a href="#MolecularStructureParser-203"><span class="linenos">203</span></a>            <span class="c1"># hardcoded: use only transforms with integers as id</span>
</span><span id="MolecularStructureParser-204"><a href="#MolecularStructureParser-204"><span class="linenos">204</span></a>            <span class="n">assemblyatoms</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser-205"><a href="#MolecularStructureParser-205"><span class="linenos">205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="MolecularStructureParser-206"><a href="#MolecularStructureParser-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-207"><a href="#MolecularStructureParser-207"><span class="linenos">207</span></a>            <span class="n">assembly_reference_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser-208"><a href="#MolecularStructureParser-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="MolecularStructureParser-209"><a href="#MolecularStructureParser-209"><span class="linenos">209</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="MolecularStructureParser-210"><a href="#MolecularStructureParser-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="MolecularStructureParser-211"><a href="#MolecularStructureParser-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">assemblyatoms</span>
</span><span id="MolecularStructureParser-212"><a href="#MolecularStructureParser-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MolecularStructureParser-213"><a href="#MolecularStructureParser-213"><span class="linenos">213</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-214"><a href="#MolecularStructureParser-214"><span class="linenos">214</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="MolecularStructureParser-215"><a href="#MolecularStructureParser-215"><span class="linenos">215</span></a>                <span class="p">)</span>
</span><span id="MolecularStructureParser-216"><a href="#MolecularStructureParser-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="MolecularStructureParser-217"><a href="#MolecularStructureParser-217"><span class="linenos">217</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-218"><a href="#MolecularStructureParser-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="MolecularStructureParser-219"><a href="#MolecularStructureParser-219"><span class="linenos">219</span></a>            <span class="c1"># define axis</span>
</span><span id="MolecularStructureParser-220"><a href="#MolecularStructureParser-220"><span class="linenos">220</span></a>            <span class="c1"># print(&quot;Defining axis from rotations&quot;)</span>
</span><span id="MolecularStructureParser-221"><a href="#MolecularStructureParser-221"><span class="linenos">221</span></a>            <span class="n">vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_axis_from_rotations</span><span class="p">()</span>
</span><span id="MolecularStructureParser-222"><a href="#MolecularStructureParser-222"><span class="linenos">222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">(</span><span class="n">vect</span><span class="p">)</span>
</span><span id="MolecularStructureParser-223"><a href="#MolecularStructureParser-223"><span class="linenos">223</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-224"><a href="#MolecularStructureParser-224"><span class="linenos">224</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser-225"><a href="#MolecularStructureParser-225"><span class="linenos">225</span></a>            <span class="c1">#    &quot;Strcture is not defined by assymetric units. Using only atoms in file&quot;</span>
</span><span id="MolecularStructureParser-226"><a href="#MolecularStructureParser-226"><span class="linenos">226</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser-227"><a href="#MolecularStructureParser-227"><span class="linenos">227</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="MolecularStructureParser-228"><a href="#MolecularStructureParser-228"><span class="linenos">228</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="MolecularStructureParser-229"><a href="#MolecularStructureParser-229"><span class="linenos">229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser-230"><a href="#MolecularStructureParser-230"><span class="linenos">230</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-231"><a href="#MolecularStructureParser-231"><span class="linenos">231</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="MolecularStructureParser-232"><a href="#MolecularStructureParser-232"><span class="linenos">232</span></a>                <span class="p">)</span>
</span><span id="MolecularStructureParser-233"><a href="#MolecularStructureParser-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">allatoms_defined</span>
</span><span id="MolecularStructureParser-234"><a href="#MolecularStructureParser-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MolecularStructureParser-235"><a href="#MolecularStructureParser-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="MolecularStructureParser-236"><a href="#MolecularStructureParser-236"><span class="linenos">236</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-237"><a href="#MolecularStructureParser-237"><span class="linenos">237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser-238"><a href="#MolecularStructureParser-238"><span class="linenos">238</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">()</span>  <span class="c1"># default [0,0,1]</span>
</span><span id="MolecularStructureParser-239"><a href="#MolecularStructureParser-239"><span class="linenos">239</span></a>
</span><span id="MolecularStructureParser-240"><a href="#MolecularStructureParser-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">_get_assemblyatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-241"><a href="#MolecularStructureParser-241"><span class="linenos">241</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-242"><a href="#MolecularStructureParser-242"><span class="linenos">242</span></a>
</span><span id="MolecularStructureParser-243"><a href="#MolecularStructureParser-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">set_axis_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_defining_point</span><span class="p">):</span>
</span><span id="MolecularStructureParser-244"><a href="#MolecularStructureParser-244"><span class="linenos">244</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">axis_defining_point</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="MolecularStructureParser-245"><a href="#MolecularStructureParser-245"><span class="linenos">245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
</span><span id="MolecularStructureParser-246"><a href="#MolecularStructureParser-246"><span class="linenos">246</span></a>
</span><span id="MolecularStructureParser-247"><a href="#MolecularStructureParser-247"><span class="linenos">247</span></a>    <span class="c1"># central axis definition</span>
</span><span id="MolecularStructureParser-248"><a href="#MolecularStructureParser-248"><span class="linenos">248</span></a>
</span><span id="MolecularStructureParser-249"><a href="#MolecularStructureParser-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">set_axis_with_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])):</span>
</span><span id="MolecularStructureParser-250"><a href="#MolecularStructureParser-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">vector</span><span class="p">)</span>
</span><span id="MolecularStructureParser-251"><a href="#MolecularStructureParser-251"><span class="linenos">251</span></a>
</span><span id="MolecularStructureParser-252"><a href="#MolecularStructureParser-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">_central_axis_from_rotations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser-253"><a href="#MolecularStructureParser-253"><span class="linenos">253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-254"><a href="#MolecularStructureParser-254"><span class="linenos">254</span></a><span class="sd">        Calculate the central axis orientation from the assembly operations</span>
</span><span id="MolecularStructureParser-255"><a href="#MolecularStructureParser-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-256"><a href="#MolecularStructureParser-256"><span class="linenos">256</span></a>        <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="MolecularStructureParser-257"><a href="#MolecularStructureParser-257"><span class="linenos">257</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="MolecularStructureParser-258"><a href="#MolecularStructureParser-258"><span class="linenos">258</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">)):</span>
</span><span id="MolecularStructureParser-259"><a href="#MolecularStructureParser-259"><span class="linenos">259</span></a>            <span class="n">average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">average</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MolecularStructureParser-260"><a href="#MolecularStructureParser-260"><span class="linenos">260</span></a>        <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">average</span><span class="p">)</span>
</span><span id="MolecularStructureParser-261"><a href="#MolecularStructureParser-261"><span class="linenos">261</span></a>        <span class="n">central_axis</span> <span class="o">=</span> <span class="n">eigenvectors</span><span class="p">[</span>
</span><span id="MolecularStructureParser-262"><a href="#MolecularStructureParser-262"><span class="linenos">262</span></a>            <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
</span><span id="MolecularStructureParser-263"><a href="#MolecularStructureParser-263"><span class="linenos">263</span></a>        <span class="p">]</span>  <span class="c1"># central axis is the eigenvector that corresponds to the eigenvalue = 1</span>
</span><span id="MolecularStructureParser-264"><a href="#MolecularStructureParser-264"><span class="linenos">264</span></a>        <span class="k">return</span> <span class="n">central_axis</span>
</span><span id="MolecularStructureParser-265"><a href="#MolecularStructureParser-265"><span class="linenos">265</span></a>
</span><span id="MolecularStructureParser-266"><a href="#MolecularStructureParser-266"><span class="linenos">266</span></a>    <span class="c1"># Parsing atoms</span>
</span><span id="MolecularStructureParser-267"><a href="#MolecularStructureParser-267"><span class="linenos">267</span></a>
</span><span id="MolecularStructureParser-268"><a href="#MolecularStructureParser-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">_get_atom_res_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">resnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atomnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="MolecularStructureParser-269"><a href="#MolecularStructureParser-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-270"><a href="#MolecularStructureParser-270"><span class="linenos">270</span></a><span class="sd">        Parse the structure generated and return desired atoms coordinates</span>
</span><span id="MolecularStructureParser-271"><a href="#MolecularStructureParser-271"><span class="linenos">271</span></a><span class="sd">        defined with atom name, residue id and chain id.</span>
</span><span id="MolecularStructureParser-272"><a href="#MolecularStructureParser-272"><span class="linenos">272</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-273"><a href="#MolecularStructureParser-273"><span class="linenos">273</span></a>        <span class="n">myatoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-274"><a href="#MolecularStructureParser-274"><span class="linenos">274</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser-275"><a href="#MolecularStructureParser-275"><span class="linenos">275</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
</span><span id="MolecularStructureParser-276"><a href="#MolecularStructureParser-276"><span class="linenos">276</span></a>                <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">chainnames</span><span class="p">:</span>
</span><span id="MolecularStructureParser-277"><a href="#MolecularStructureParser-277"><span class="linenos">277</span></a>                    <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="MolecularStructureParser-278"><a href="#MolecularStructureParser-278"><span class="linenos">278</span></a>                        <span class="c1"># this conditional checks if the residue is</span>
</span><span id="MolecularStructureParser-279"><a href="#MolecularStructureParser-279"><span class="linenos">279</span></a>                        <span class="c1"># defined in resname list</span>
</span><span id="MolecularStructureParser-280"><a href="#MolecularStructureParser-280"><span class="linenos">280</span></a>                        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">resnames</span><span class="p">:</span>
</span><span id="MolecularStructureParser-281"><a href="#MolecularStructureParser-281"><span class="linenos">281</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser-282"><a href="#MolecularStructureParser-282"><span class="linenos">282</span></a>                                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">atomnames</span><span class="p">:</span>
</span><span id="MolecularStructureParser-283"><a href="#MolecularStructureParser-283"><span class="linenos">283</span></a>                                    <span class="n">myatoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">())</span>
</span><span id="MolecularStructureParser-284"><a href="#MolecularStructureParser-284"><span class="linenos">284</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">)</span>
</span><span id="MolecularStructureParser-285"><a href="#MolecularStructureParser-285"><span class="linenos">285</span></a>
</span><span id="MolecularStructureParser-286"><a href="#MolecularStructureParser-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">_get_site_specific</span><span class="p">(</span>
</span><span id="MolecularStructureParser-287"><a href="#MolecularStructureParser-287"><span class="linenos">287</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">chainnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">resnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atomnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MolecularStructureParser-288"><a href="#MolecularStructureParser-288"><span class="linenos">288</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser-289"><a href="#MolecularStructureParser-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-290"><a href="#MolecularStructureParser-290"><span class="linenos">290</span></a><span class="sd">        Parse the structure generated and return desired atoms coordinates</span>
</span><span id="MolecularStructureParser-291"><a href="#MolecularStructureParser-291"><span class="linenos">291</span></a><span class="sd">        defined with atom name, residue id and chain id</span>
</span><span id="MolecularStructureParser-292"><a href="#MolecularStructureParser-292"><span class="linenos">292</span></a>
</span><span id="MolecularStructureParser-293"><a href="#MolecularStructureParser-293"><span class="linenos">293</span></a><span class="sd">        It is intended to return only one position per chain</span>
</span><span id="MolecularStructureParser-294"><a href="#MolecularStructureParser-294"><span class="linenos">294</span></a><span class="sd">        The position will be counted from the cosntructed chains so that</span>
</span><span id="MolecularStructureParser-295"><a href="#MolecularStructureParser-295"><span class="linenos">295</span></a><span class="sd">        Is is heavily dependant of all the chain to be defined</span>
</span><span id="MolecularStructureParser-296"><a href="#MolecularStructureParser-296"><span class="linenos">296</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-297"><a href="#MolecularStructureParser-297"><span class="linenos">297</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking in: </span><span class="si">{</span><span class="n">chainnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">resnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">atomnames</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-298"><a href="#MolecularStructureParser-298"><span class="linenos">298</span></a>        <span class="n">myatoms</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-299"><a href="#MolecularStructureParser-299"><span class="linenos">299</span></a>        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser-300"><a href="#MolecularStructureParser-300"><span class="linenos">300</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">model</span><span class="p">:</span>
</span><span id="MolecularStructureParser-301"><a href="#MolecularStructureParser-301"><span class="linenos">301</span></a>                <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">chainnames</span><span class="p">:</span>
</span><span id="MolecularStructureParser-302"><a href="#MolecularStructureParser-302"><span class="linenos">302</span></a>                    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MolecularStructureParser-303"><a href="#MolecularStructureParser-303"><span class="linenos">303</span></a>                    <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="MolecularStructureParser-304"><a href="#MolecularStructureParser-304"><span class="linenos">304</span></a>                        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MolecularStructureParser-305"><a href="#MolecularStructureParser-305"><span class="linenos">305</span></a>                        <span class="c1"># this conditional checks if the residue is</span>
</span><span id="MolecularStructureParser-306"><a href="#MolecularStructureParser-306"><span class="linenos">306</span></a>                        <span class="c1"># defined in resname list</span>
</span><span id="MolecularStructureParser-307"><a href="#MolecularStructureParser-307"><span class="linenos">307</span></a>                        <span class="nb">print</span><span class="p">(</span>
</span><span id="MolecularStructureParser-308"><a href="#MolecularStructureParser-308"><span class="linenos">308</span></a>                            <span class="sa">f</span><span class="s2">&quot;resname </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">get_resname</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="MolecularStructureParser-309"><a href="#MolecularStructureParser-309"><span class="linenos">309</span></a>                            <span class="sa">f</span><span class="s2">&quot;segid: </span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">get_segid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="MolecularStructureParser-310"><a href="#MolecularStructureParser-310"><span class="linenos">310</span></a>                        <span class="p">)</span>
</span><span id="MolecularStructureParser-311"><a href="#MolecularStructureParser-311"><span class="linenos">311</span></a>                        <span class="k">if</span> <span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">resnames</span> <span class="ow">and</span> <span class="n">position</span> <span class="o">==</span> <span class="n">pos</span><span class="p">:</span>
</span><span id="MolecularStructureParser-312"><a href="#MolecularStructureParser-312"><span class="linenos">312</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser-313"><a href="#MolecularStructureParser-313"><span class="linenos">313</span></a>                                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">atomnames</span><span class="p">:</span>
</span><span id="MolecularStructureParser-314"><a href="#MolecularStructureParser-314"><span class="linenos">314</span></a>                                    <span class="n">myatoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_coord</span><span class="p">())</span>
</span><span id="MolecularStructureParser-315"><a href="#MolecularStructureParser-315"><span class="linenos">315</span></a>                                    <span class="nb">print</span><span class="p">(</span>
</span><span id="MolecularStructureParser-316"><a href="#MolecularStructureParser-316"><span class="linenos">316</span></a>                                        <span class="sa">f</span><span class="s2">&quot;site speficic found: </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="MolecularStructureParser-317"><a href="#MolecularStructureParser-317"><span class="linenos">317</span></a>                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">residue</span><span class="o">.</span><span class="n">resname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="MolecularStructureParser-318"><a href="#MolecularStructureParser-318"><span class="linenos">318</span></a>                                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2"> &quot;</span>
</span><span id="MolecularStructureParser-319"><a href="#MolecularStructureParser-319"><span class="linenos">319</span></a>                                    <span class="p">)</span>
</span><span id="MolecularStructureParser-320"><a href="#MolecularStructureParser-320"><span class="linenos">320</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">))</span>
</span><span id="MolecularStructureParser-321"><a href="#MolecularStructureParser-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myatoms</span><span class="p">)</span>
</span><span id="MolecularStructureParser-322"><a href="#MolecularStructureParser-322"><span class="linenos">322</span></a>
</span><span id="MolecularStructureParser-323"><a href="#MolecularStructureParser-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="MolecularStructureParser-324"><a href="#MolecularStructureParser-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser-325"><a href="#MolecularStructureParser-325"><span class="linenos">325</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser-326"><a href="#MolecularStructureParser-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-327"><a href="#MolecularStructureParser-327"><span class="linenos">327</span></a><span class="sd">        Parse the structure return desired atoms coordinates</span>
</span><span id="MolecularStructureParser-328"><a href="#MolecularStructureParser-328"><span class="linenos">328</span></a><span class="sd">        defined with atom name, residue id and chain id.</span>
</span><span id="MolecularStructureParser-329"><a href="#MolecularStructureParser-329"><span class="linenos">329</span></a>
</span><span id="MolecularStructureParser-330"><a href="#MolecularStructureParser-330"><span class="linenos">330</span></a><span class="sd">        Output has shape Nx3. N is number of atoms</span>
</span><span id="MolecularStructureParser-331"><a href="#MolecularStructureParser-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-332"><a href="#MolecularStructureParser-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-333"><a href="#MolecularStructureParser-333"><span class="linenos">333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="MolecularStructureParser-334"><a href="#MolecularStructureParser-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-335"><a href="#MolecularStructureParser-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="MolecularStructureParser-336"><a href="#MolecularStructureParser-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-337"><a href="#MolecularStructureParser-337"><span class="linenos">337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser-338"><a href="#MolecularStructureParser-338"><span class="linenos">338</span></a>        <span class="n">list_of_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="MolecularStructureParser-339"><a href="#MolecularStructureParser-339"><span class="linenos">339</span></a>        <span class="c1"># chains in structure on which to look for</span>
</span><span id="MolecularStructureParser-340"><a href="#MolecularStructureParser-340"><span class="linenos">340</span></a>        <span class="c1"># print(f&quot;Using chains {list_of_chains}&quot;)</span>
</span><span id="MolecularStructureParser-341"><a href="#MolecularStructureParser-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-342"><a href="#MolecularStructureParser-342"><span class="linenos">342</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_res_chain</span><span class="p">(</span><span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>
</span><span id="MolecularStructureParser-343"><a href="#MolecularStructureParser-343"><span class="linenos">343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-344"><a href="#MolecularStructureParser-344"><span class="linenos">344</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_site_specific</span><span class="p">(</span>
</span><span id="MolecularStructureParser-345"><a href="#MolecularStructureParser-345"><span class="linenos">345</span></a>                <span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">position</span>
</span><span id="MolecularStructureParser-346"><a href="#MolecularStructureParser-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-347"><a href="#MolecularStructureParser-347"><span class="linenos">347</span></a>        <span class="c1"># atom_res_chain only considers a signle asymmetric unit</span>
</span><span id="MolecularStructureParser-348"><a href="#MolecularStructureParser-348"><span class="linenos">348</span></a>        <span class="c1"># if the CIF defines an assembly, the asymmetric partners</span>
</span><span id="MolecularStructureParser-349"><a href="#MolecularStructureParser-349"><span class="linenos">349</span></a>        <span class="c1"># or atom_res_chain are generated as well</span>
</span><span id="MolecularStructureParser-350"><a href="#MolecularStructureParser-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser-351"><a href="#MolecularStructureParser-351"><span class="linenos">351</span></a>            <span class="c1"># print(&quot;Generating symmetry partners for atoms parsed&quot;)</span>
</span><span id="MolecularStructureParser-352"><a href="#MolecularStructureParser-352"><span class="linenos">352</span></a>            <span class="n">atom_res_chain_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser-353"><a href="#MolecularStructureParser-353"><span class="linenos">353</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">atom_res_chain</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="MolecularStructureParser-354"><a href="#MolecularStructureParser-354"><span class="linenos">354</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-355"><a href="#MolecularStructureParser-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="n">atom_res_chain_assembly</span>
</span><span id="MolecularStructureParser-356"><a href="#MolecularStructureParser-356"><span class="linenos">356</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-357"><a href="#MolecularStructureParser-357"><span class="linenos">357</span></a>            <span class="k">return</span> <span class="n">atom_res_chain</span>
</span><span id="MolecularStructureParser-358"><a href="#MolecularStructureParser-358"><span class="linenos">358</span></a>
</span><span id="MolecularStructureParser-359"><a href="#MolecularStructureParser-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser-360"><a href="#MolecularStructureParser-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-361"><a href="#MolecularStructureParser-361"><span class="linenos">361</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="MolecularStructureParser-362"><a href="#MolecularStructureParser-362"><span class="linenos">362</span></a><span class="sd">        defined as Direct labeling</span>
</span><span id="MolecularStructureParser-363"><a href="#MolecularStructureParser-363"><span class="linenos">363</span></a>
</span><span id="MolecularStructureParser-364"><a href="#MolecularStructureParser-364"><span class="linenos">364</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="MolecularStructureParser-365"><a href="#MolecularStructureParser-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-366"><a href="#MolecularStructureParser-366"><span class="linenos">366</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="MolecularStructureParser-367"><a href="#MolecularStructureParser-367"><span class="linenos">367</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="MolecularStructureParser-368"><a href="#MolecularStructureParser-368"><span class="linenos">368</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="MolecularStructureParser-369"><a href="#MolecularStructureParser-369"><span class="linenos">369</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="MolecularStructureParser-370"><a href="#MolecularStructureParser-370"><span class="linenos">370</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="MolecularStructureParser-371"><a href="#MolecularStructureParser-371"><span class="linenos">371</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;residues&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser-372"><a href="#MolecularStructureParser-372"><span class="linenos">372</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser-373"><a href="#MolecularStructureParser-373"><span class="linenos">373</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser-374"><a href="#MolecularStructureParser-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-375"><a href="#MolecularStructureParser-375"><span class="linenos">375</span></a>        <span class="c1"># label_dictionary = dict(</span>
</span><span id="MolecularStructureParser-376"><a href="#MolecularStructureParser-376"><span class="linenos">376</span></a>        <span class="c1">#    coordinates=parsed,</span>
</span><span id="MolecularStructureParser-377"><a href="#MolecularStructureParser-377"><span class="linenos">377</span></a>        <span class="c1">#    labeling_efficiency=labeling_efficiency,</span>
</span><span id="MolecularStructureParser-378"><a href="#MolecularStructureParser-378"><span class="linenos">378</span></a>        <span class="c1">#    fluorophore=fluorophore,</span>
</span><span id="MolecularStructureParser-379"><a href="#MolecularStructureParser-379"><span class="linenos">379</span></a>        <span class="c1"># )</span>
</span><span id="MolecularStructureParser-380"><a href="#MolecularStructureParser-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser-381"><a href="#MolecularStructureParser-381"><span class="linenos">381</span></a>            <span class="n">parsed</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser-382"><a href="#MolecularStructureParser-382"><span class="linenos">382</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-383"><a href="#MolecularStructureParser-383"><span class="linenos">383</span></a>        <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-384"><a href="#MolecularStructureParser-384"><span class="linenos">384</span></a>            <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser-385"><a href="#MolecularStructureParser-385"><span class="linenos">385</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-386"><a href="#MolecularStructureParser-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="MolecularStructureParser-387"><a href="#MolecularStructureParser-387"><span class="linenos">387</span></a>
</span><span id="MolecularStructureParser-388"><a href="#MolecularStructureParser-388"><span class="linenos">388</span></a>    <span class="c1"># Parsing secuences</span>
</span><span id="MolecularStructureParser-389"><a href="#MolecularStructureParser-389"><span class="linenos">389</span></a>
</span><span id="MolecularStructureParser-390"><a href="#MolecularStructureParser-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobject</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser-391"><a href="#MolecularStructureParser-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-392"><a href="#MolecularStructureParser-392"><span class="linenos">392</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="MolecularStructureParser-393"><a href="#MolecularStructureParser-393"><span class="linenos">393</span></a><span class="sd">        defined as Binding labeling.</span>
</span><span id="MolecularStructureParser-394"><a href="#MolecularStructureParser-394"><span class="linenos">394</span></a>
</span><span id="MolecularStructureParser-395"><a href="#MolecularStructureParser-395"><span class="linenos">395</span></a><span class="sd">        It takes the epitope sequence and search for it in all the chains.</span>
</span><span id="MolecularStructureParser-396"><a href="#MolecularStructureParser-396"><span class="linenos">396</span></a><span class="sd">        Only considers the first appearance of such sequence.</span>
</span><span id="MolecularStructureParser-397"><a href="#MolecularStructureParser-397"><span class="linenos">397</span></a><span class="sd">        Keeps the atom coordinates form all residues in the sequence.</span>
</span><span id="MolecularStructureParser-398"><a href="#MolecularStructureParser-398"><span class="linenos">398</span></a><span class="sd">        Returns a point coordinate calculated from that sequence:</span>
</span><span id="MolecularStructureParser-399"><a href="#MolecularStructureParser-399"><span class="linenos">399</span></a><span class="sd">            Default method is coordinate average</span>
</span><span id="MolecularStructureParser-400"><a href="#MolecularStructureParser-400"><span class="linenos">400</span></a>
</span><span id="MolecularStructureParser-401"><a href="#MolecularStructureParser-401"><span class="linenos">401</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="MolecularStructureParser-402"><a href="#MolecularStructureParser-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-403"><a href="#MolecularStructureParser-403"><span class="linenos">403</span></a>        <span class="c1">#  only the first appearance of the epitope in every chain is retreived</span>
</span><span id="MolecularStructureParser-404"><a href="#MolecularStructureParser-404"><span class="linenos">404</span></a>        <span class="c1">#  if a chain has more than one epitope, only the first one is returned</span>
</span><span id="MolecularStructureParser-405"><a href="#MolecularStructureParser-405"><span class="linenos">405</span></a>        <span class="n">target_seq</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;target_sequence&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-406"><a href="#MolecularStructureParser-406"><span class="linenos">406</span></a>        <span class="n">method</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;summary_method&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-407"><a href="#MolecularStructureParser-407"><span class="linenos">407</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="MolecularStructureParser-408"><a href="#MolecularStructureParser-408"><span class="linenos">408</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="MolecularStructureParser-409"><a href="#MolecularStructureParser-409"><span class="linenos">409</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="MolecularStructureParser-410"><a href="#MolecularStructureParser-410"><span class="linenos">410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for sequence: </span><span class="si">{</span><span class="n">target_seq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-411"><a href="#MolecularStructureParser-411"><span class="linenos">411</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-412"><a href="#MolecularStructureParser-412"><span class="linenos">412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="MolecularStructureParser-413"><a href="#MolecularStructureParser-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-414"><a href="#MolecularStructureParser-414"><span class="linenos">414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span><span id="MolecularStructureParser-415"><a href="#MolecularStructureParser-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-416"><a href="#MolecularStructureParser-416"><span class="linenos">416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser-417"><a href="#MolecularStructureParser-417"><span class="linenos">417</span></a>        <span class="n">epitopes_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-418"><a href="#MolecularStructureParser-418"><span class="linenos">418</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser-419"><a href="#MolecularStructureParser-419"><span class="linenos">419</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser-420"><a href="#MolecularStructureParser-420"><span class="linenos">420</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser-421"><a href="#MolecularStructureParser-421"><span class="linenos">421</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MolecularStructureParser-422"><a href="#MolecularStructureParser-422"><span class="linenos">422</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="MolecularStructureParser-423"><a href="#MolecularStructureParser-423"><span class="linenos">423</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="MolecularStructureParser-424"><a href="#MolecularStructureParser-424"><span class="linenos">424</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="MolecularStructureParser-425"><a href="#MolecularStructureParser-425"><span class="linenos">425</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="MolecularStructureParser-426"><a href="#MolecularStructureParser-426"><span class="linenos">426</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="MolecularStructureParser-427"><a href="#MolecularStructureParser-427"><span class="linenos">427</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser-428"><a href="#MolecularStructureParser-428"><span class="linenos">428</span></a>                    <span class="k">for</span> <span class="n">residue</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))):</span>
</span><span id="MolecularStructureParser-429"><a href="#MolecularStructureParser-429"><span class="linenos">429</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="MolecularStructureParser-430"><a href="#MolecularStructureParser-430"><span class="linenos">430</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser-431"><a href="#MolecularStructureParser-431"><span class="linenos">431</span></a>                                <span class="n">coords_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="MolecularStructureParser-432"><a href="#MolecularStructureParser-432"><span class="linenos">432</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser-433"><a href="#MolecularStructureParser-433"><span class="linenos">433</span></a>                    <span class="n">epitopes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser-434"><a href="#MolecularStructureParser-434"><span class="linenos">434</span></a>        <span class="c1"># print(len(epitopes_list))</span>
</span><span id="MolecularStructureParser-435"><a href="#MolecularStructureParser-435"><span class="linenos">435</span></a>        <span class="c1"># print(f&quot;Summarizing epitopes location with method {method}&quot;)</span>
</span><span id="MolecularStructureParser-436"><a href="#MolecularStructureParser-436"><span class="linenos">436</span></a>        <span class="n">summarised_epitopes</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">summarize_epitope_atoms</span><span class="p">(</span>
</span><span id="MolecularStructureParser-437"><a href="#MolecularStructureParser-437"><span class="linenos">437</span></a>            <span class="n">epitopes_list</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="MolecularStructureParser-438"><a href="#MolecularStructureParser-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-439"><a href="#MolecularStructureParser-439"><span class="linenos">439</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="MolecularStructureParser-440"><a href="#MolecularStructureParser-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser-441"><a href="#MolecularStructureParser-441"><span class="linenos">441</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating symmetry partners for epitopes parsed&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-442"><a href="#MolecularStructureParser-442"><span class="linenos">442</span></a>            <span class="n">epitopes_locations_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser-443"><a href="#MolecularStructureParser-443"><span class="linenos">443</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span>
</span><span id="MolecularStructureParser-444"><a href="#MolecularStructureParser-444"><span class="linenos">444</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span>
</span><span id="MolecularStructureParser-445"><a href="#MolecularStructureParser-445"><span class="linenos">445</span></a>                <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser-446"><a href="#MolecularStructureParser-446"><span class="linenos">446</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-447"><a href="#MolecularStructureParser-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser-448"><a href="#MolecularStructureParser-448"><span class="linenos">448</span></a>                <span class="n">epitopes_locations_assembly</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser-449"><a href="#MolecularStructureParser-449"><span class="linenos">449</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-450"><a href="#MolecularStructureParser-450"><span class="linenos">450</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-451"><a href="#MolecularStructureParser-451"><span class="linenos">451</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser-452"><a href="#MolecularStructureParser-452"><span class="linenos">452</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-453"><a href="#MolecularStructureParser-453"><span class="linenos">453</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="MolecularStructureParser-454"><a href="#MolecularStructureParser-454"><span class="linenos">454</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-455"><a href="#MolecularStructureParser-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser-456"><a href="#MolecularStructureParser-456"><span class="linenos">456</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser-457"><a href="#MolecularStructureParser-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-458"><a href="#MolecularStructureParser-458"><span class="linenos">458</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-459"><a href="#MolecularStructureParser-459"><span class="linenos">459</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser-460"><a href="#MolecularStructureParser-460"><span class="linenos">460</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-461"><a href="#MolecularStructureParser-461"><span class="linenos">461</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="MolecularStructureParser-462"><a href="#MolecularStructureParser-462"><span class="linenos">462</span></a>
</span><span id="MolecularStructureParser-463"><a href="#MolecularStructureParser-463"><span class="linenos">463</span></a>    <span class="k">def</span> <span class="nf">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser-464"><a href="#MolecularStructureParser-464"><span class="linenos">464</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span><span class="p">,</span> <span class="n">normals</span><span class="o">=</span><span class="kc">None</span>
</span><span id="MolecularStructureParser-465"><a href="#MolecularStructureParser-465"><span class="linenos">465</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser-466"><a href="#MolecularStructureParser-466"><span class="linenos">466</span></a>        <span class="n">label_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-467"><a href="#MolecularStructureParser-467"><span class="linenos">467</span></a>            <span class="n">coordinates</span><span class="o">=</span><span class="n">coordinates</span><span class="p">,</span>  <span class="c1"># this makes the difference</span>
</span><span id="MolecularStructureParser-468"><a href="#MolecularStructureParser-468"><span class="linenos">468</span></a>            <span class="n">labeling_efficiency</span><span class="o">=</span><span class="n">labeling_efficiency</span><span class="p">,</span>
</span><span id="MolecularStructureParser-469"><a href="#MolecularStructureParser-469"><span class="linenos">469</span></a>            <span class="n">fluorophore</span><span class="o">=</span><span class="n">fluorophore</span><span class="p">,</span>
</span><span id="MolecularStructureParser-470"><a href="#MolecularStructureParser-470"><span class="linenos">470</span></a>            <span class="n">normals</span><span class="o">=</span><span class="n">normals</span><span class="p">,</span>
</span><span id="MolecularStructureParser-471"><a href="#MolecularStructureParser-471"><span class="linenos">471</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-472"><a href="#MolecularStructureParser-472"><span class="linenos">472</span></a>        <span class="k">return</span> <span class="n">label_dictionary</span>
</span><span id="MolecularStructureParser-473"><a href="#MolecularStructureParser-473"><span class="linenos">473</span></a>
</span><span id="MolecularStructureParser-474"><a href="#MolecularStructureParser-474"><span class="linenos">474</span></a>    <span class="c1"># generate targets from label info</span>
</span><span id="MolecularStructureParser-475"><a href="#MolecularStructureParser-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">gen_Targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser-476"><a href="#MolecularStructureParser-476"><span class="linenos">476</span></a>        <span class="c1"># call the generator depending on the target type</span>
</span><span id="MolecularStructureParser-477"><a href="#MolecularStructureParser-477"><span class="linenos">477</span></a>        <span class="k">if</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Atom_residue&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-478"><a href="#MolecularStructureParser-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_atoms</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularStructureParser-479"><a href="#MolecularStructureParser-479"><span class="linenos">479</span></a>        <span class="k">elif</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser-480"><a href="#MolecularStructureParser-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_sequence</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularStructureParser-481"><a href="#MolecularStructureParser-481"><span class="linenos">481</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-482"><a href="#MolecularStructureParser-482"><span class="linenos">482</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label type </span><span class="si">{</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span><span class="si">}</span><span class="s2"> is not a valid label&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-483"><a href="#MolecularStructureParser-483"><span class="linenos">483</span></a>
</span><span id="MolecularStructureParser-484"><a href="#MolecularStructureParser-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">get_target_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser-485"><a href="#MolecularStructureParser-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-486"><a href="#MolecularStructureParser-486"><span class="linenos">486</span></a>
</span><span id="MolecularStructureParser-487"><a href="#MolecularStructureParser-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">get_target_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser-488"><a href="#MolecularStructureParser-488"><span class="linenos">488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-489"><a href="#MolecularStructureParser-489"><span class="linenos">489</span></a>
</span><span id="MolecularStructureParser-490"><a href="#MolecularStructureParser-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">get_target_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser-491"><a href="#MolecularStructureParser-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;plotcolour&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-492"><a href="#MolecularStructureParser-492"><span class="linenos">492</span></a>
</span><span id="MolecularStructureParser-493"><a href="#MolecularStructureParser-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">set_labefficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">newefficiency</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="MolecularStructureParser-494"><a href="#MolecularStructureParser-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetname</span><span class="p">][</span><span class="s2">&quot;labeling_efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newefficiency</span>
</span><span id="MolecularStructureParser-495"><a href="#MolecularStructureParser-495"><span class="linenos">495</span></a>
</span><span id="MolecularStructureParser-496"><a href="#MolecularStructureParser-496"><span class="linenos">496</span></a>    <span class="c1"># visualisation</span>
</span><span id="MolecularStructureParser-497"><a href="#MolecularStructureParser-497"><span class="linenos">497</span></a>    <span class="k">def</span> <span class="nf">show_target_labels</span><span class="p">(</span>
</span><span id="MolecularStructureParser-498"><a href="#MolecularStructureParser-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MolecularStructureParser-499"><a href="#MolecularStructureParser-499"><span class="linenos">499</span></a>        <span class="n">labelnames</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MolecularStructureParser-500"><a href="#MolecularStructureParser-500"><span class="linenos">500</span></a>        <span class="n">with_assembly_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser-501"><a href="#MolecularStructureParser-501"><span class="linenos">501</span></a>        <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="MolecularStructureParser-502"><a href="#MolecularStructureParser-502"><span class="linenos">502</span></a>        <span class="n">reference_point</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser-503"><a href="#MolecularStructureParser-503"><span class="linenos">503</span></a>        <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MolecularStructureParser-504"><a href="#MolecularStructureParser-504"><span class="linenos">504</span></a>        <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser-505"><a href="#MolecularStructureParser-505"><span class="linenos">505</span></a>        <span class="n">show_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser-506"><a href="#MolecularStructureParser-506"><span class="linenos">506</span></a>        <span class="n">with_normals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser-507"><a href="#MolecularStructureParser-507"><span class="linenos">507</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser-508"><a href="#MolecularStructureParser-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">labelnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-509"><a href="#MolecularStructureParser-509"><span class="linenos">509</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="MolecularStructureParser-510"><a href="#MolecularStructureParser-510"><span class="linenos">510</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-511"><a href="#MolecularStructureParser-511"><span class="linenos">511</span></a>            <span class="k">for</span> <span class="n">trgt</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="MolecularStructureParser-512"><a href="#MolecularStructureParser-512"><span class="linenos">512</span></a>                <span class="k">if</span> <span class="n">with_normals</span><span class="p">:</span>
</span><span id="MolecularStructureParser-513"><a href="#MolecularStructureParser-513"><span class="linenos">513</span></a>                    <span class="n">draw_nomral_segments</span><span class="p">(</span>
</span><span id="MolecularStructureParser-514"><a href="#MolecularStructureParser-514"><span class="linenos">514</span></a>                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_target_normals</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="MolecularStructureParser-515"><a href="#MolecularStructureParser-515"><span class="linenos">515</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser-516"><a href="#MolecularStructureParser-516"><span class="linenos">516</span></a>                        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_colour</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="MolecularStructureParser-517"><a href="#MolecularStructureParser-517"><span class="linenos">517</span></a>                    <span class="p">)</span>
</span><span id="MolecularStructureParser-518"><a href="#MolecularStructureParser-518"><span class="linenos">518</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser-519"><a href="#MolecularStructureParser-519"><span class="linenos">519</span></a>                    <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser-520"><a href="#MolecularStructureParser-520"><span class="linenos">520</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser-521"><a href="#MolecularStructureParser-521"><span class="linenos">521</span></a>                        <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="MolecularStructureParser-522"><a href="#MolecularStructureParser-522"><span class="linenos">522</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">trgt</span><span class="p">]</span>
</span><span id="MolecularStructureParser-523"><a href="#MolecularStructureParser-523"><span class="linenos">523</span></a>                        <span class="p">),</span>
</span><span id="MolecularStructureParser-524"><a href="#MolecularStructureParser-524"><span class="linenos">524</span></a>                    <span class="p">)</span>
</span><span id="MolecularStructureParser-525"><a href="#MolecularStructureParser-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="n">with_assembly_atoms</span><span class="p">:</span>
</span><span id="MolecularStructureParser-526"><a href="#MolecularStructureParser-526"><span class="linenos">526</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-527"><a href="#MolecularStructureParser-527"><span class="linenos">527</span></a>            <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="MolecularStructureParser-528"><a href="#MolecularStructureParser-528"><span class="linenos">528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="MolecularStructureParser-529"><a href="#MolecularStructureParser-529"><span class="linenos">529</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-530"><a href="#MolecularStructureParser-530"><span class="linenos">530</span></a>            <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser-531"><a href="#MolecularStructureParser-531"><span class="linenos">531</span></a>                <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser-532"><a href="#MolecularStructureParser-532"><span class="linenos">532</span></a>                <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="MolecularStructureParser-533"><a href="#MolecularStructureParser-533"><span class="linenos">533</span></a>                    <span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-534"><a href="#MolecularStructureParser-534"><span class="linenos">534</span></a>                <span class="p">),</span>
</span><span id="MolecularStructureParser-535"><a href="#MolecularStructureParser-535"><span class="linenos">535</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-536"><a href="#MolecularStructureParser-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="n">reference_point</span><span class="p">:</span>
</span><span id="MolecularStructureParser-537"><a href="#MolecularStructureParser-537"><span class="linenos">537</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference point at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-538"><a href="#MolecularStructureParser-538"><span class="linenos">538</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser-539"><a href="#MolecularStructureParser-539"><span class="linenos">539</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MolecularStructureParser-540"><a href="#MolecularStructureParser-540"><span class="linenos">540</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MolecularStructureParser-541"><a href="#MolecularStructureParser-541"><span class="linenos">541</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MolecularStructureParser-542"><a href="#MolecularStructureParser-542"><span class="linenos">542</span></a>                <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser-543"><a href="#MolecularStructureParser-543"><span class="linenos">543</span></a>                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reoriented&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser-544"><a href="#MolecularStructureParser-544"><span class="linenos">544</span></a>                <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span id="MolecularStructureParser-545"><a href="#MolecularStructureParser-545"><span class="linenos">545</span></a>                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser-546"><a href="#MolecularStructureParser-546"><span class="linenos">546</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-547"><a href="#MolecularStructureParser-547"><span class="linenos">547</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="MolecularStructureParser-548"><a href="#MolecularStructureParser-548"><span class="linenos">548</span></a>        <span class="k">if</span> <span class="n">show_axis</span><span class="p">:</span>
</span><span id="MolecularStructureParser-549"><a href="#MolecularStructureParser-549"><span class="linenos">549</span></a>            <span class="n">draw1nomral_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lenght</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</span><span id="MolecularStructureParser-550"><a href="#MolecularStructureParser-550"><span class="linenos">550</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MolecularStructureParser-551"><a href="#MolecularStructureParser-551"><span class="linenos">551</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="MolecularStructureParser-552"><a href="#MolecularStructureParser-552"><span class="linenos">552</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="MolecularStructureParser-553"><a href="#MolecularStructureParser-553"><span class="linenos">553</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-554"><a href="#MolecularStructureParser-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="MolecularStructureParser-555"><a href="#MolecularStructureParser-555"><span class="linenos">555</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="MolecularStructureParser-556"><a href="#MolecularStructureParser-556"><span class="linenos">556</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span><span id="MolecularStructureParser-557"><a href="#MolecularStructureParser-557"><span class="linenos">557</span></a>
</span><span id="MolecularStructureParser-558"><a href="#MolecularStructureParser-558"><span class="linenos">558</span></a>    <span class="k">def</span> <span class="nf">show_assembly_atoms</span><span class="p">(</span>
</span><span id="MolecularStructureParser-559"><a href="#MolecularStructureParser-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MolecularStructureParser-560"><a href="#MolecularStructureParser-560"><span class="linenos">560</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser-561"><a href="#MolecularStructureParser-561"><span class="linenos">561</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-562"><a href="#MolecularStructureParser-562"><span class="linenos">562</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="MolecularStructureParser-563"><a href="#MolecularStructureParser-563"><span class="linenos">563</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-564"><a href="#MolecularStructureParser-564"><span class="linenos">564</span></a>        <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="MolecularStructureParser-565"><a href="#MolecularStructureParser-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="MolecularStructureParser-566"><a href="#MolecularStructureParser-566"><span class="linenos">566</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-567"><a href="#MolecularStructureParser-567"><span class="linenos">567</span></a>        <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser-568"><a href="#MolecularStructureParser-568"><span class="linenos">568</span></a>            <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser-569"><a href="#MolecularStructureParser-569"><span class="linenos">569</span></a>            <span class="n">format_coordinates</span><span class="p">(</span><span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]),</span>
</span><span id="MolecularStructureParser-570"><a href="#MolecularStructureParser-570"><span class="linenos">570</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-571"><a href="#MolecularStructureParser-571"><span class="linenos">571</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MolecularStructureParser-572"><a href="#MolecularStructureParser-572"><span class="linenos">572</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="MolecularStructureParser-573"><a href="#MolecularStructureParser-573"><span class="linenos">573</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="MolecularStructureParser-574"><a href="#MolecularStructureParser-574"><span class="linenos">574</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-575"><a href="#MolecularStructureParser-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="MolecularStructureParser-576"><a href="#MolecularStructureParser-576"><span class="linenos">576</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="MolecularStructureParser-577"><a href="#MolecularStructureParser-577"><span class="linenos">577</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span><span id="MolecularStructureParser-578"><a href="#MolecularStructureParser-578"><span class="linenos">578</span></a>
</span><span id="MolecularStructureParser-579"><a href="#MolecularStructureParser-579"><span class="linenos">579</span></a>    <span class="k">def</span> <span class="nf">create_instance_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savingdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MolecularStructureParser-580"><a href="#MolecularStructureParser-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-581"><a href="#MolecularStructureParser-581"><span class="linenos">581</span></a><span class="sd">        create a dictionary with the information from putative label sites</span>
</span><span id="MolecularStructureParser-582"><a href="#MolecularStructureParser-582"><span class="linenos">582</span></a><span class="sd">        with their associated normals and general parameters such as axis,</span>
</span><span id="MolecularStructureParser-583"><a href="#MolecularStructureParser-583"><span class="linenos">583</span></a><span class="sd">        reference point, etc.</span>
</span><span id="MolecularStructureParser-584"><a href="#MolecularStructureParser-584"><span class="linenos">584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser-585"><a href="#MolecularStructureParser-585"><span class="linenos">585</span></a>        <span class="n">targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser-586"><a href="#MolecularStructureParser-586"><span class="linenos">586</span></a>        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MolecularStructureParser-587"><a href="#MolecularStructureParser-587"><span class="linenos">587</span></a>            <span class="n">targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser-588"><a href="#MolecularStructureParser-588"><span class="linenos">588</span></a>                <span class="n">coordinates</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">],</span> <span class="n">normals</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser-589"><a href="#MolecularStructureParser-589"><span class="linenos">589</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser-590"><a href="#MolecularStructureParser-590"><span class="linenos">590</span></a>        <span class="n">instance_builder</span> <span class="o">=</span> <span class="n">builder_format</span><span class="p">(</span>
</span><span id="MolecularStructureParser-591"><a href="#MolecularStructureParser-591"><span class="linenos">591</span></a>            <span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span>
</span><span id="MolecularStructureParser-592"><a href="#MolecularStructureParser-592"><span class="linenos">592</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser-593"><a href="#MolecularStructureParser-593"><span class="linenos">593</span></a>        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
</span><span id="MolecularStructureParser-594"><a href="#MolecularStructureParser-594"><span class="linenos">594</span></a>            <span class="k">if</span> <span class="n">savingdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser-595"><a href="#MolecularStructureParser-595"><span class="linenos">595</span></a>                <span class="n">savingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="MolecularStructureParser-596"><a href="#MolecularStructureParser-596"><span class="linenos">596</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">savingdir</span> <span class="o">+</span> <span class="s2">&quot;/instance_builder_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
</span><span id="MolecularStructureParser-597"><a href="#MolecularStructureParser-597"><span class="linenos">597</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="MolecularStructureParser-598"><a href="#MolecularStructureParser-598"><span class="linenos">598</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Builder saved in: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser-599"><a href="#MolecularStructureParser-599"><span class="linenos">599</span></a>                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">instance_builder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="MolecularStructureParser-600"><a href="#MolecularStructureParser-600"><span class="linenos">600</span></a>        <span class="k">return</span> <span class="n">instance_builder</span>
</span></pre></div>


    

                            <div id="MolecularStructureParser.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.id"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.chain_builder" class="classattr">
                                <div class="attr variable">
            <span class="name">chain_builder</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.chain_builder"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.ch_builder_max_dist" class="classattr">
                                <div class="attr variable">
            <span class="name">ch_builder_max_dist</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.ch_builder_max_dist"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.ppgen" class="classattr">
                                <div class="attr variable">
            <span class="name">ppgen</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.ppgen"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.CIFdictionary" class="classattr">
                                <div class="attr variable">
            <span class="name">CIFdictionary</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.CIFdictionary"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.assembly_operations" class="classattr">
                                <div class="attr variable">
            <span class="name">assembly_operations</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.assembly_operations"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.chains_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">chains_dict</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.chains_dict"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.assembly_refpt" class="classattr">
                                <div class="attr variable">
            <span class="name">assembly_refpt</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.assembly_refpt"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.assembly_atoms" class="classattr">
                                <div class="attr variable">
            <span class="name">assembly_atoms</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.assembly_atoms"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.num_assembly_atoms" class="classattr">
                                <div class="attr variable">
            <span class="name">num_assembly_atoms</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.num_assembly_atoms"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.store_atoms_assembly" class="classattr">
                                <div class="attr variable">
            <span class="name">store_atoms_assembly</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.store_atoms_assembly"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.assymetric_defined" class="classattr">
                                <div class="attr variable">
            <span class="name">assymetric_defined</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.assymetric_defined"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.label_targets" class="classattr">
                                <div class="attr variable">
            <span class="name">label_targets</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.label_targets"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.label_normals" class="classattr">
                                <div class="attr variable">
            <span class="name">label_normals</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.label_normals"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.plotting_params" class="classattr">
                                <div class="attr variable">
            <span class="name">plotting_params</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.plotting_params"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.scale" class="classattr">
                                <div class="attr variable">
            <span class="name">scale</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.scale"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.axis" class="classattr">
                                <div class="attr variable">
            <span class="name">axis</span>

        
    </div>
    <a class="headerlink" href="#MolecularStructureParser.axis"></a>
    
    

                            </div>
                            <div id="MolecularStructureParser.initialise_parsers" class="classattr">
                                        <input id="MolecularStructureParser.initialise_parsers-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">initialise_parsers</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.initialise_parsers-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.initialise_parsers"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.initialise_parsers-58"><a href="#MolecularStructureParser.initialise_parsers-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">initialise_parsers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MolecularStructureParser.initialise_parsers-59"><a href="#MolecularStructureParser.initialise_parsers-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.initialise_parsers-60"><a href="#MolecularStructureParser.initialise_parsers-60"><span class="linenos">60</span></a><span class="sd">        Create molecular structure of the PDB/CIF based on</span>
</span><span id="MolecularStructureParser.initialise_parsers-61"><a href="#MolecularStructureParser.initialise_parsers-61"><span class="linenos">61</span></a><span class="sd">        its format and associated parameters.</span>
</span><span id="MolecularStructureParser.initialise_parsers-62"><a href="#MolecularStructureParser.initialise_parsers-62"><span class="linenos">62</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.initialise_parsers-63"><a href="#MolecularStructureParser.initialise_parsers-63"><span class="linenos">63</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parsing structure. This might take a few seconds...&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.initialise_parsers-64"><a href="#MolecularStructureParser.initialise_parsers-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;file&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.initialise_parsers-65"><a href="#MolecularStructureParser.initialise_parsers-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.initialise_parsers-66"><a href="#MolecularStructureParser.initialise_parsers-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.initialise_parsers-67"><a href="#MolecularStructureParser.initialise_parsers-67"><span class="linenos">67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">dictionary</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.initialise_parsers-68"><a href="#MolecularStructureParser.initialise_parsers-68"><span class="linenos">68</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;PDB&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.initialise_parsers-69"><a href="#MolecularStructureParser.initialise_parsers-69"><span class="linenos">69</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">PDBParser</span><span class="p">()</span>
</span><span id="MolecularStructureParser.initialise_parsers-70"><a href="#MolecularStructureParser.initialise_parsers-70"><span class="linenos">70</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="MolecularStructureParser.initialise_parsers-71"><a href="#MolecularStructureParser.initialise_parsers-71"><span class="linenos">71</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s2">&quot;CIF&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.initialise_parsers-72"><a href="#MolecularStructureParser.initialise_parsers-72"><span class="linenos">72</span></a>            <span class="n">parser</span> <span class="o">=</span> <span class="n">MMCIFParser</span><span class="p">()</span>
</span><span id="MolecularStructureParser.initialise_parsers-73"><a href="#MolecularStructureParser.initialise_parsers-73"><span class="linenos">73</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">struct</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_structure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span><span id="MolecularStructureParser.initialise_parsers-74"><a href="#MolecularStructureParser.initialise_parsers-74"><span class="linenos">74</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.initialise_parsers-75"><a href="#MolecularStructureParser.initialise_parsers-75"><span class="linenos">75</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="si">}</span><span class="s2"> is not a valid format. Valid options are PDB or CIF.&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.initialise_parsers-76"><a href="#MolecularStructureParser.initialise_parsers-76"><span class="linenos">76</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;PPBuilder&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.initialise_parsers-77"><a href="#MolecularStructureParser.initialise_parsers-77"><span class="linenos">77</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">PPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span><span id="MolecularStructureParser.initialise_parsers-78"><a href="#MolecularStructureParser.initialise_parsers-78"><span class="linenos">78</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_builder</span> <span class="o">==</span> <span class="s2">&quot;CaPPBuilder&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.initialise_parsers-79"><a href="#MolecularStructureParser.initialise_parsers-79"><span class="linenos">79</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span> <span class="o">=</span> <span class="n">CaPPBuilder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ch_builder_max_dist</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create molecular structure of the PDB/CIF based on
its format and associated parameters.</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.build_structure" class="classattr">
                                        <input id="MolecularStructureParser.build_structure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_structure</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.build_structure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.build_structure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.build_structure-85"><a href="#MolecularStructureParser.build_structure-85"><span class="linenos">85</span></a>    <span class="k">def</span> <span class="nf">build_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.build_structure-86"><a href="#MolecularStructureParser.build_structure-86"><span class="linenos">86</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Building structure for: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.build_structure-87"><a href="#MolecularStructureParser.build_structure-87"><span class="linenos">87</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.build_structure-88"><a href="#MolecularStructureParser.build_structure-88"><span class="linenos">88</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="MolecularStructureParser.build_structure-89"><a href="#MolecularStructureParser.build_structure-89"><span class="linenos">89</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.build_structure-90"><a href="#MolecularStructureParser.build_structure-90"><span class="linenos">90</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser.build_structure-91"><a href="#MolecularStructureParser.build_structure-91"><span class="linenos">91</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.build_structure-92"><a href="#MolecularStructureParser.build_structure-92"><span class="linenos">92</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.generate_MMCIF_dictionary" class="classattr">
                                        <input id="MolecularStructureParser.generate_MMCIF_dictionary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_MMCIF_dictionary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.generate_MMCIF_dictionary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.generate_MMCIF_dictionary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.generate_MMCIF_dictionary-94"><a href="#MolecularStructureParser.generate_MMCIF_dictionary-94"><span class="linenos">94</span></a>    <span class="k">def</span> <span class="nf">generate_MMCIF_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.generate_MMCIF_dictionary-95"><a href="#MolecularStructureParser.generate_MMCIF_dictionary-95"><span class="linenos">95</span></a>        <span class="c1"># generate the dictionary with all field parsed from CIF file</span>
</span><span id="MolecularStructureParser.generate_MMCIF_dictionary-96"><a href="#MolecularStructureParser.generate_MMCIF_dictionary-96"><span class="linenos">96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="o">=</span> <span class="n">MMCIF2Dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_file</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.get_atoms_infile" class="classattr">
                                        <input id="MolecularStructureParser.get_atoms_infile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_atoms_infile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.get_atoms_infile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.get_atoms_infile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.get_atoms_infile-98"><a href="#MolecularStructureParser.get_atoms_infile-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">get_atoms_infile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.get_atoms_infile-99"><a href="#MolecularStructureParser.get_atoms_infile-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.get_atoms_infile-100"><a href="#MolecularStructureParser.get_atoms_infile-100"><span class="linenos">100</span></a><span class="sd">        Obtain all atom coordinates written the PDB/CIF file.</span>
</span><span id="MolecularStructureParser.get_atoms_infile-101"><a href="#MolecularStructureParser.get_atoms_infile-101"><span class="linenos">101</span></a><span class="sd">        Only the asymmetric unit is parsed.</span>
</span><span id="MolecularStructureParser.get_atoms_infile-102"><a href="#MolecularStructureParser.get_atoms_infile-102"><span class="linenos">102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.get_atoms_infile-103"><a href="#MolecularStructureParser.get_atoms_infile-103"><span class="linenos">103</span></a>        <span class="n">coordinates</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser.get_atoms_infile-104"><a href="#MolecularStructureParser.get_atoms_infile-104"><span class="linenos">104</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atoms_infile-105"><a href="#MolecularStructureParser.get_atoms_infile-105"><span class="linenos">105</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atoms_infile-106"><a href="#MolecularStructureParser.get_atoms_infile-106"><span class="linenos">106</span></a>                <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atoms_infile-107"><a href="#MolecularStructureParser.get_atoms_infile-107"><span class="linenos">107</span></a>                    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atoms_infile-108"><a href="#MolecularStructureParser.get_atoms_infile-108"><span class="linenos">108</span></a>                        <span class="n">coordinates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="MolecularStructureParser.get_atoms_infile-109"><a href="#MolecularStructureParser.get_atoms_infile-109"><span class="linenos">109</span></a>        <span class="c1"># get array is a method for the class vector of biopython.</span>
</span><span id="MolecularStructureParser.get_atoms_infile-110"><a href="#MolecularStructureParser.get_atoms_infile-110"><span class="linenos">110</span></a>        <span class="c1"># np.array(atom.get_vector()) does not return the coordinates from the vector</span>
</span><span id="MolecularStructureParser.get_atoms_infile-111"><a href="#MolecularStructureParser.get_atoms_infile-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Obtain all atom coordinates written the PDB/CIF file.
Only the asymmetric unit is parsed.</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.generate_chains_sequences" class="classattr">
                                        <input id="MolecularStructureParser.generate_chains_sequences-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_chains_sequences</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.generate_chains_sequences-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.generate_chains_sequences"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.generate_chains_sequences-113"><a href="#MolecularStructureParser.generate_chains_sequences-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">generate_chains_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-114"><a href="#MolecularStructureParser.generate_chains_sequences-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-115"><a href="#MolecularStructureParser.generate_chains_sequences-115"><span class="linenos">115</span></a><span class="sd">        Constructs a dictionary with chain ids as keys and</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-116"><a href="#MolecularStructureParser.generate_chains_sequences-116"><span class="linenos">116</span></a><span class="sd">        each chain value contains the string of the</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-117"><a href="#MolecularStructureParser.generate_chains_sequences-117"><span class="linenos">117</span></a><span class="sd">        peptide built using the specified self.chain_builder</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-118"><a href="#MolecularStructureParser.generate_chains_sequences-118"><span class="linenos">118</span></a>
</span><span id="MolecularStructureParser.generate_chains_sequences-119"><a href="#MolecularStructureParser.generate_chains_sequences-119"><span class="linenos">119</span></a><span class="sd">        When these chains are used for searching epitope sequences.</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-120"><a href="#MolecularStructureParser.generate_chains_sequences-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-121"><a href="#MolecularStructureParser.generate_chains_sequences-121"><span class="linenos">121</span></a>        <span class="n">seq_chains_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-122"><a href="#MolecularStructureParser.generate_chains_sequences-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-123"><a href="#MolecularStructureParser.generate_chains_sequences-123"><span class="linenos">123</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-124"><a href="#MolecularStructureParser.generate_chains_sequences-124"><span class="linenos">124</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-125"><a href="#MolecularStructureParser.generate_chains_sequences-125"><span class="linenos">125</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-126"><a href="#MolecularStructureParser.generate_chains_sequences-126"><span class="linenos">126</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-127"><a href="#MolecularStructureParser.generate_chains_sequences-127"><span class="linenos">127</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-128"><a href="#MolecularStructureParser.generate_chains_sequences-128"><span class="linenos">128</span></a>                <span class="n">seq_chains_dict</span><span class="p">[</span><span class="n">chain</span><span class="o">.</span><span class="n">get_id</span><span class="p">()]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-129"><a href="#MolecularStructureParser.generate_chains_sequences-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="o">=</span> <span class="n">seq_chains_dict</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-130"><a href="#MolecularStructureParser.generate_chains_sequences-130"><span class="linenos">130</span></a>        <span class="c1"># nchains = len(list(seq_chains_dict.keys()))</span>
</span><span id="MolecularStructureParser.generate_chains_sequences-131"><a href="#MolecularStructureParser.generate_chains_sequences-131"><span class="linenos">131</span></a>        <span class="c1"># print(f&quot;file contains {nchains} chains&quot;)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a dictionary with chain ids as keys and
each chain value contains the string of the
peptide built using the specified self.chain_builder</p>

<p>When these chains are used for searching epitope sequences.</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.generate_assemmbly_operations" class="classattr">
                                        <input id="MolecularStructureParser.generate_assemmbly_operations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_assemmbly_operations</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.generate_assemmbly_operations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.generate_assemmbly_operations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.generate_assemmbly_operations-133"><a href="#MolecularStructureParser.generate_assemmbly_operations-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">generate_assemmbly_operations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-134"><a href="#MolecularStructureParser.generate_assemmbly_operations-134"><span class="linenos">134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-135"><a href="#MolecularStructureParser.generate_assemmbly_operations-135"><span class="linenos">135</span></a><span class="sd">        Parse the rotation/translation operation needed to</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-136"><a href="#MolecularStructureParser.generate_assemmbly_operations-136"><span class="linenos">136</span></a><span class="sd">        construct a molecular assembly from an asymmetric unit</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-137"><a href="#MolecularStructureParser.generate_assemmbly_operations-137"><span class="linenos">137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-138"><a href="#MolecularStructureParser.generate_assemmbly_operations-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># check if already created</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-139"><a href="#MolecularStructureParser.generate_assemmbly_operations-139"><span class="linenos">139</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_MMCIF_dictionary</span><span class="p">()</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-140"><a href="#MolecularStructureParser.generate_assemmbly_operations-140"><span class="linenos">140</span></a>        <span class="c1"># get to know how many transformations there are</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-141"><a href="#MolecularStructureParser.generate_assemmbly_operations-141"><span class="linenos">141</span></a>        <span class="n">transformation_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.id&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-142"><a href="#MolecularStructureParser.generate_assemmbly_operations-142"><span class="linenos">142</span></a>        <span class="c1"># each element of the list is pair of matrix-vector needed to transform data</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-143"><a href="#MolecularStructureParser.generate_assemmbly_operations-143"><span class="linenos">143</span></a>        <span class="c1"># iterate over each of the transformations</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-144"><a href="#MolecularStructureParser.generate_assemmbly_operations-144"><span class="linenos">144</span></a>        <span class="n">assembly_transformations</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-145"><a href="#MolecularStructureParser.generate_assemmbly_operations-145"><span class="linenos">145</span></a>        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)):</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-146"><a href="#MolecularStructureParser.generate_assemmbly_operations-146"><span class="linenos">146</span></a>            <span class="n">row1</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-147"><a href="#MolecularStructureParser.generate_assemmbly_operations-147"><span class="linenos">147</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-148"><a href="#MolecularStructureParser.generate_assemmbly_operations-148"><span class="linenos">148</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-149"><a href="#MolecularStructureParser.generate_assemmbly_operations-149"><span class="linenos">149</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[1][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-150"><a href="#MolecularStructureParser.generate_assemmbly_operations-150"><span class="linenos">150</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-151"><a href="#MolecularStructureParser.generate_assemmbly_operations-151"><span class="linenos">151</span></a>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-152"><a href="#MolecularStructureParser.generate_assemmbly_operations-152"><span class="linenos">152</span></a>            <span class="n">row2</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-153"><a href="#MolecularStructureParser.generate_assemmbly_operations-153"><span class="linenos">153</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-154"><a href="#MolecularStructureParser.generate_assemmbly_operations-154"><span class="linenos">154</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-155"><a href="#MolecularStructureParser.generate_assemmbly_operations-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[2][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-156"><a href="#MolecularStructureParser.generate_assemmbly_operations-156"><span class="linenos">156</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-157"><a href="#MolecularStructureParser.generate_assemmbly_operations-157"><span class="linenos">157</span></a>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-158"><a href="#MolecularStructureParser.generate_assemmbly_operations-158"><span class="linenos">158</span></a>            <span class="n">row3</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-159"><a href="#MolecularStructureParser.generate_assemmbly_operations-159"><span class="linenos">159</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-160"><a href="#MolecularStructureParser.generate_assemmbly_operations-160"><span class="linenos">160</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-161"><a href="#MolecularStructureParser.generate_assemmbly_operations-161"><span class="linenos">161</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.matrix[3][3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-162"><a href="#MolecularStructureParser.generate_assemmbly_operations-162"><span class="linenos">162</span></a>            <span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-163"><a href="#MolecularStructureParser.generate_assemmbly_operations-163"><span class="linenos">163</span></a>            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row1</span><span class="p">,</span> <span class="n">row2</span><span class="p">,</span> <span class="n">row3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-164"><a href="#MolecularStructureParser.generate_assemmbly_operations-164"><span class="linenos">164</span></a>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-165"><a href="#MolecularStructureParser.generate_assemmbly_operations-165"><span class="linenos">165</span></a>            <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-166"><a href="#MolecularStructureParser.generate_assemmbly_operations-166"><span class="linenos">166</span></a>                <span class="p">[</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-167"><a href="#MolecularStructureParser.generate_assemmbly_operations-167"><span class="linenos">167</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[1]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-168"><a href="#MolecularStructureParser.generate_assemmbly_operations-168"><span class="linenos">168</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[2]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-169"><a href="#MolecularStructureParser.generate_assemmbly_operations-169"><span class="linenos">169</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">CIFdictionary</span><span class="p">[</span><span class="s2">&quot;_pdbx_struct_oper_list.vector[3]&quot;</span><span class="p">][</span><span class="n">tr</span><span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-170"><a href="#MolecularStructureParser.generate_assemmbly_operations-170"><span class="linenos">170</span></a>                <span class="p">],</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-171"><a href="#MolecularStructureParser.generate_assemmbly_operations-171"><span class="linenos">171</span></a>                <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;float&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-172"><a href="#MolecularStructureParser.generate_assemmbly_operations-172"><span class="linenos">172</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-173"><a href="#MolecularStructureParser.generate_assemmbly_operations-173"><span class="linenos">173</span></a>            <span class="n">assembly_transformations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rotation_matrix</span><span class="p">,</span> <span class="n">vector</span><span class="p">])</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-174"><a href="#MolecularStructureParser.generate_assemmbly_operations-174"><span class="linenos">174</span></a>        <span class="n">struct_oper_dictionary</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">,</span> <span class="n">assembly_transformations</span><span class="p">))</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-175"><a href="#MolecularStructureParser.generate_assemmbly_operations-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transformation_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-176"><a href="#MolecularStructureParser.generate_assemmbly_operations-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-177"><a href="#MolecularStructureParser.generate_assemmbly_operations-177"><span class="linenos">177</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-178"><a href="#MolecularStructureParser.generate_assemmbly_operations-178"><span class="linenos">178</span></a>            <span class="c1">#    &quot;This model is defined with more than one symmetric transformation.</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-179"><a href="#MolecularStructureParser.generate_assemmbly_operations-179"><span class="linenos">179</span></a>            <span class="c1"># Will consider the assembly as assymetric defined&quot;</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-180"><a href="#MolecularStructureParser.generate_assemmbly_operations-180"><span class="linenos">180</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-181"><a href="#MolecularStructureParser.generate_assemmbly_operations-181"><span class="linenos">181</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-182"><a href="#MolecularStructureParser.generate_assemmbly_operations-182"><span class="linenos">182</span></a>            <span class="c1"># when no assembly unit exist, there is only 1 transform expected</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-183"><a href="#MolecularStructureParser.generate_assemmbly_operations-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-184"><a href="#MolecularStructureParser.generate_assemmbly_operations-184"><span class="linenos">184</span></a>            <span class="c1"># print(&quot;This model is defined with only one symmetric transformation&quot;)</span>
</span><span id="MolecularStructureParser.generate_assemmbly_operations-185"><a href="#MolecularStructureParser.generate_assemmbly_operations-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="o">=</span> <span class="n">struct_oper_dictionary</span>
</span></pre></div>


            <div class="docstring"><p>Parse the rotation/translation operation needed to
construct a molecular assembly from an asymmetric unit</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.generate_assembly_reference_point" class="classattr">
                                        <input id="MolecularStructureParser.generate_assembly_reference_point-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generate_assembly_reference_point</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.generate_assembly_reference_point-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.generate_assembly_reference_point"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.generate_assembly_reference_point-187"><a href="#MolecularStructureParser.generate_assembly_reference_point-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">generate_assembly_reference_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-188"><a href="#MolecularStructureParser.generate_assembly_reference_point-188"><span class="linenos">188</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-189"><a href="#MolecularStructureParser.generate_assembly_reference_point-189"><span class="linenos">189</span></a><span class="sd">        Generate a reference point for the whole structure by</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-190"><a href="#MolecularStructureParser.generate_assembly_reference_point-190"><span class="linenos">190</span></a><span class="sd">        constructing a full assembly (transforming the assymetric unit)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-191"><a href="#MolecularStructureParser.generate_assembly_reference_point-191"><span class="linenos">191</span></a><span class="sd">        with the assembly operations if needed.</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-192"><a href="#MolecularStructureParser.generate_assembly_reference_point-192"><span class="linenos">192</span></a><span class="sd">        Then averaging all atoms including asymmetric partners if exist.</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-193"><a href="#MolecularStructureParser.generate_assembly_reference_point-193"><span class="linenos">193</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-194"><a href="#MolecularStructureParser.generate_assembly_reference_point-194"><span class="linenos">194</span></a>        <span class="c1"># this function could use a small portion of the atoms defined only</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-195"><a href="#MolecularStructureParser.generate_assembly_reference_point-195"><span class="linenos">195</span></a>        <span class="n">allatoms_defined</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atoms_infile</span><span class="p">()</span>  <span class="c1"># Parse all atoms in file</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-196"><a href="#MolecularStructureParser.generate_assembly_reference_point-196"><span class="linenos">196</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-197"><a href="#MolecularStructureParser.generate_assembly_reference_point-197"><span class="linenos">197</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-198"><a href="#MolecularStructureParser.generate_assembly_reference_point-198"><span class="linenos">198</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-199"><a href="#MolecularStructureParser.generate_assembly_reference_point-199"><span class="linenos">199</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-200"><a href="#MolecularStructureParser.generate_assembly_reference_point-200"><span class="linenos">200</span></a>            <span class="c1">#    &quot;Strcture is defined by assymetric units.</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-201"><a href="#MolecularStructureParser.generate_assembly_reference_point-201"><span class="linenos">201</span></a>            <span class="c1"># Generating symmetry partners with the following transformations.&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-202"><a href="#MolecularStructureParser.generate_assembly_reference_point-202"><span class="linenos">202</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-203"><a href="#MolecularStructureParser.generate_assembly_reference_point-203"><span class="linenos">203</span></a>            <span class="c1"># hardcoded: use only transforms with integers as id</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-204"><a href="#MolecularStructureParser.generate_assembly_reference_point-204"><span class="linenos">204</span></a>            <span class="n">assemblyatoms</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-205"><a href="#MolecularStructureParser.generate_assembly_reference_point-205"><span class="linenos">205</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-206"><a href="#MolecularStructureParser.generate_assembly_reference_point-206"><span class="linenos">206</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-207"><a href="#MolecularStructureParser.generate_assembly_reference_point-207"><span class="linenos">207</span></a>            <span class="n">assembly_reference_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-208"><a href="#MolecularStructureParser.generate_assembly_reference_point-208"><span class="linenos">208</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-209"><a href="#MolecularStructureParser.generate_assembly_reference_point-209"><span class="linenos">209</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-210"><a href="#MolecularStructureParser.generate_assembly_reference_point-210"><span class="linenos">210</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-211"><a href="#MolecularStructureParser.generate_assembly_reference_point-211"><span class="linenos">211</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">assemblyatoms</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-212"><a href="#MolecularStructureParser.generate_assembly_reference_point-212"><span class="linenos">212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">assemblyatoms</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-213"><a href="#MolecularStructureParser.generate_assembly_reference_point-213"><span class="linenos">213</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-214"><a href="#MolecularStructureParser.generate_assembly_reference_point-214"><span class="linenos">214</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-215"><a href="#MolecularStructureParser.generate_assembly_reference_point-215"><span class="linenos">215</span></a>                <span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-216"><a href="#MolecularStructureParser.generate_assembly_reference_point-216"><span class="linenos">216</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-217"><a href="#MolecularStructureParser.generate_assembly_reference_point-217"><span class="linenos">217</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-218"><a href="#MolecularStructureParser.generate_assembly_reference_point-218"><span class="linenos">218</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">assembly_reference_point</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-219"><a href="#MolecularStructureParser.generate_assembly_reference_point-219"><span class="linenos">219</span></a>            <span class="c1"># define axis</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-220"><a href="#MolecularStructureParser.generate_assembly_reference_point-220"><span class="linenos">220</span></a>            <span class="c1"># print(&quot;Defining axis from rotations&quot;)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-221"><a href="#MolecularStructureParser.generate_assembly_reference_point-221"><span class="linenos">221</span></a>            <span class="n">vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_central_axis_from_rotations</span><span class="p">()</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-222"><a href="#MolecularStructureParser.generate_assembly_reference_point-222"><span class="linenos">222</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">(</span><span class="n">vect</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-223"><a href="#MolecularStructureParser.generate_assembly_reference_point-223"><span class="linenos">223</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-224"><a href="#MolecularStructureParser.generate_assembly_reference_point-224"><span class="linenos">224</span></a>            <span class="c1"># print(</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-225"><a href="#MolecularStructureParser.generate_assembly_reference_point-225"><span class="linenos">225</span></a>            <span class="c1">#    &quot;Strcture is not defined by assymetric units. Using only atoms in file&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-226"><a href="#MolecularStructureParser.generate_assembly_reference_point-226"><span class="linenos">226</span></a>            <span class="c1"># )</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-227"><a href="#MolecularStructureParser.generate_assembly_reference_point-227"><span class="linenos">227</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_atoms_assembly</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-228"><a href="#MolecularStructureParser.generate_assembly_reference_point-228"><span class="linenos">228</span></a>                <span class="c1"># print(&quot;Storing assembly atoms&quot;)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-229"><a href="#MolecularStructureParser.generate_assembly_reference_point-229"><span class="linenos">229</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-230"><a href="#MolecularStructureParser.generate_assembly_reference_point-230"><span class="linenos">230</span></a>                <span class="n">assembly_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-231"><a href="#MolecularStructureParser.generate_assembly_reference_point-231"><span class="linenos">231</span></a>                    <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="s2">&quot;#000000&quot;</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-232"><a href="#MolecularStructureParser.generate_assembly_reference_point-232"><span class="linenos">232</span></a>                <span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-233"><a href="#MolecularStructureParser.generate_assembly_reference_point-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span> <span class="o">=</span> <span class="n">allatoms_defined</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-234"><a href="#MolecularStructureParser.generate_assembly_reference_point-234"><span class="linenos">234</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">num_assembly_atoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-235"><a href="#MolecularStructureParser.generate_assembly_reference_point-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">assembly_plotting_params</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-236"><a href="#MolecularStructureParser.generate_assembly_reference_point-236"><span class="linenos">236</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-237"><a href="#MolecularStructureParser.generate_assembly_reference_point-237"><span class="linenos">237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">allatoms_defined</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MolecularStructureParser.generate_assembly_reference_point-238"><a href="#MolecularStructureParser.generate_assembly_reference_point-238"><span class="linenos">238</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_axis_with_vector</span><span class="p">()</span>  <span class="c1"># default [0,0,1]</span>
</span></pre></div>


            <div class="docstring"><p>Generate a reference point for the whole structure by
constructing a full assembly (transforming the assymetric unit)
with the assembly operations if needed.
Then averaging all atoms including asymmetric partners if exist.</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.set_axis_from_point" class="classattr">
                                        <input id="MolecularStructureParser.set_axis_from_point-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_axis_from_point</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">axis_defining_point</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.set_axis_from_point-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.set_axis_from_point"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.set_axis_from_point-243"><a href="#MolecularStructureParser.set_axis_from_point-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">set_axis_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_defining_point</span><span class="p">):</span>
</span><span id="MolecularStructureParser.set_axis_from_point-244"><a href="#MolecularStructureParser.set_axis_from_point-244"><span class="linenos">244</span></a>        <span class="n">direction</span> <span class="o">=</span> <span class="n">axis_defining_point</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="MolecularStructureParser.set_axis_from_point-245"><a href="#MolecularStructureParser.set_axis_from_point-245"><span class="linenos">245</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.set_axis_with_vector" class="classattr">
                                        <input id="MolecularStructureParser.set_axis_with_vector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_axis_with_vector</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vector</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.set_axis_with_vector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.set_axis_with_vector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.set_axis_with_vector-249"><a href="#MolecularStructureParser.set_axis_with_vector-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">set_axis_with_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])):</span>
</span><span id="MolecularStructureParser.set_axis_with_vector-250"><a href="#MolecularStructureParser.set_axis_with_vector-250"><span class="linenos">250</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">vector</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.get_atom_res_chains_assembly" class="classattr">
                                        <input id="MolecularStructureParser.get_atom_res_chains_assembly-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_atom_res_chains_assembly</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">residues</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.get_atom_res_chains_assembly-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.get_atom_res_chains_assembly"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.get_atom_res_chains_assembly-323"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-324"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-324"><span class="linenos">324</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">atoms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-325"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-325"><span class="linenos">325</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-326"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-326"><span class="linenos">326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-327"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-327"><span class="linenos">327</span></a><span class="sd">        Parse the structure return desired atoms coordinates</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-328"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-328"><span class="linenos">328</span></a><span class="sd">        defined with atom name, residue id and chain id.</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-329"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-329"><span class="linenos">329</span></a>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-330"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-330"><span class="linenos">330</span></a><span class="sd">        Output has shape Nx3. N is number of atoms</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-331"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-332"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-332"><span class="linenos">332</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-333"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-333"><span class="linenos">333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-334"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-334"><span class="linenos">334</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-335"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-335"><span class="linenos">335</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>  <span class="c1"># Initialized as none</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-336"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-336"><span class="linenos">336</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-337"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-337"><span class="linenos">337</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-338"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-338"><span class="linenos">338</span></a>        <span class="n">list_of_chains</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-339"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-339"><span class="linenos">339</span></a>        <span class="c1"># chains in structure on which to look for</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-340"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-340"><span class="linenos">340</span></a>        <span class="c1"># print(f&quot;Using chains {list_of_chains}&quot;)</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-341"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-342"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-342"><span class="linenos">342</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_atom_res_chain</span><span class="p">(</span><span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">)</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-343"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-343"><span class="linenos">343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-344"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-344"><span class="linenos">344</span></a>            <span class="n">atom_res_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_site_specific</span><span class="p">(</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-345"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-345"><span class="linenos">345</span></a>                <span class="n">list_of_chains</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">position</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-346"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-346"><span class="linenos">346</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-347"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-347"><span class="linenos">347</span></a>        <span class="c1"># atom_res_chain only considers a signle asymmetric unit</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-348"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-348"><span class="linenos">348</span></a>        <span class="c1"># if the CIF defines an assembly, the asymmetric partners</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-349"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-349"><span class="linenos">349</span></a>        <span class="c1"># or atom_res_chain are generated as well</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-350"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-351"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-351"><span class="linenos">351</span></a>            <span class="c1"># print(&quot;Generating symmetry partners for atoms parsed&quot;)</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-352"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-352"><span class="linenos">352</span></a>            <span class="n">atom_res_chain_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-353"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-353"><span class="linenos">353</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span> <span class="n">atom_res_chain</span><span class="p">,</span> <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-354"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-354"><span class="linenos">354</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-355"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-355"><span class="linenos">355</span></a>            <span class="k">return</span> <span class="n">atom_res_chain_assembly</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-356"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-356"><span class="linenos">356</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.get_atom_res_chains_assembly-357"><a href="#MolecularStructureParser.get_atom_res_chains_assembly-357"><span class="linenos">357</span></a>            <span class="k">return</span> <span class="n">atom_res_chain</span>
</span></pre></div>


            <div class="docstring"><p>Parse the structure return desired atoms coordinates
defined with atom name, residue id and chain id.</p>

<p>Output has shape Nx3. N is number of atoms</p>
</div>


                            </div>
                            <div id="MolecularStructureParser.gen_targets_by_atoms" class="classattr">
                                        <input id="MolecularStructureParser.gen_targets_by_atoms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_targets_by_atoms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labelobj</span><span class="p">:</span> <span class="n"><a href="labels.html#Label">supramolsim.generate.labels.Label</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.gen_targets_by_atoms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.gen_targets_by_atoms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.gen_targets_by_atoms-359"><a href="#MolecularStructureParser.gen_targets_by_atoms-359"><span class="linenos">359</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_atoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-360"><a href="#MolecularStructureParser.gen_targets_by_atoms-360"><span class="linenos">360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-361"><a href="#MolecularStructureParser.gen_targets_by_atoms-361"><span class="linenos">361</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-362"><a href="#MolecularStructureParser.gen_targets_by_atoms-362"><span class="linenos">362</span></a><span class="sd">        defined as Direct labeling</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-363"><a href="#MolecularStructureParser.gen_targets_by_atoms-363"><span class="linenos">363</span></a>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-364"><a href="#MolecularStructureParser.gen_targets_by_atoms-364"><span class="linenos">364</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-365"><a href="#MolecularStructureParser.gen_targets_by_atoms-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-366"><a href="#MolecularStructureParser.gen_targets_by_atoms-366"><span class="linenos">366</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-367"><a href="#MolecularStructureParser.gen_targets_by_atoms-367"><span class="linenos">367</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-368"><a href="#MolecularStructureParser.gen_targets_by_atoms-368"><span class="linenos">368</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-369"><a href="#MolecularStructureParser.gen_targets_by_atoms-369"><span class="linenos">369</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-370"><a href="#MolecularStructureParser.gen_targets_by_atoms-370"><span class="linenos">370</span></a>        <span class="n">parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_atom_res_chains_assembly</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-371"><a href="#MolecularStructureParser.gen_targets_by_atoms-371"><span class="linenos">371</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;residues&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-372"><a href="#MolecularStructureParser.gen_targets_by_atoms-372"><span class="linenos">372</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-373"><a href="#MolecularStructureParser.gen_targets_by_atoms-373"><span class="linenos">373</span></a>            <span class="n">labelobj</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">],</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-374"><a href="#MolecularStructureParser.gen_targets_by_atoms-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-375"><a href="#MolecularStructureParser.gen_targets_by_atoms-375"><span class="linenos">375</span></a>        <span class="c1"># label_dictionary = dict(</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-376"><a href="#MolecularStructureParser.gen_targets_by_atoms-376"><span class="linenos">376</span></a>        <span class="c1">#    coordinates=parsed,</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-377"><a href="#MolecularStructureParser.gen_targets_by_atoms-377"><span class="linenos">377</span></a>        <span class="c1">#    labeling_efficiency=labeling_efficiency,</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-378"><a href="#MolecularStructureParser.gen_targets_by_atoms-378"><span class="linenos">378</span></a>        <span class="c1">#    fluorophore=fluorophore,</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-379"><a href="#MolecularStructureParser.gen_targets_by_atoms-379"><span class="linenos">379</span></a>        <span class="c1"># )</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-380"><a href="#MolecularStructureParser.gen_targets_by_atoms-380"><span class="linenos">380</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-381"><a href="#MolecularStructureParser.gen_targets_by_atoms-381"><span class="linenos">381</span></a>            <span class="n">parsed</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-382"><a href="#MolecularStructureParser.gen_targets_by_atoms-382"><span class="linenos">382</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-383"><a href="#MolecularStructureParser.gen_targets_by_atoms-383"><span class="linenos">383</span></a>        <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-384"><a href="#MolecularStructureParser.gen_targets_by_atoms-384"><span class="linenos">384</span></a>            <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-385"><a href="#MolecularStructureParser.gen_targets_by_atoms-385"><span class="linenos">385</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_atoms-386"><a href="#MolecularStructureParser.gen_targets_by_atoms-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span></pre></div>


            <div class="docstring"><p>Generate target locations for the labelling
defined as Direct labeling</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>labelobj</strong>:  instance of the class Label</li>
</ul>
</div>


                            </div>
                            <div id="MolecularStructureParser.gen_targets_by_sequence" class="classattr">
                                        <input id="MolecularStructureParser.gen_targets_by_sequence-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_targets_by_sequence</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labelobject</span><span class="p">:</span> <span class="n"><a href="labels.html#Label">supramolsim.generate.labels.Label</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.gen_targets_by_sequence-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.gen_targets_by_sequence"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.gen_targets_by_sequence-390"><a href="#MolecularStructureParser.gen_targets_by_sequence-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">gen_targets_by_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobject</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-391"><a href="#MolecularStructureParser.gen_targets_by_sequence-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-392"><a href="#MolecularStructureParser.gen_targets_by_sequence-392"><span class="linenos">392</span></a><span class="sd">        Generate target locations for the labelling</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-393"><a href="#MolecularStructureParser.gen_targets_by_sequence-393"><span class="linenos">393</span></a><span class="sd">        defined as Binding labeling.</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-394"><a href="#MolecularStructureParser.gen_targets_by_sequence-394"><span class="linenos">394</span></a>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-395"><a href="#MolecularStructureParser.gen_targets_by_sequence-395"><span class="linenos">395</span></a><span class="sd">        It takes the epitope sequence and search for it in all the chains.</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-396"><a href="#MolecularStructureParser.gen_targets_by_sequence-396"><span class="linenos">396</span></a><span class="sd">        Only considers the first appearance of such sequence.</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-397"><a href="#MolecularStructureParser.gen_targets_by_sequence-397"><span class="linenos">397</span></a><span class="sd">        Keeps the atom coordinates form all residues in the sequence.</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-398"><a href="#MolecularStructureParser.gen_targets_by_sequence-398"><span class="linenos">398</span></a><span class="sd">        Returns a point coordinate calculated from that sequence:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-399"><a href="#MolecularStructureParser.gen_targets_by_sequence-399"><span class="linenos">399</span></a><span class="sd">            Default method is coordinate average</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-400"><a href="#MolecularStructureParser.gen_targets_by_sequence-400"><span class="linenos">400</span></a>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-401"><a href="#MolecularStructureParser.gen_targets_by_sequence-401"><span class="linenos">401</span></a><span class="sd">        :param labelobj: instance of the class Label</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-402"><a href="#MolecularStructureParser.gen_targets_by_sequence-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-403"><a href="#MolecularStructureParser.gen_targets_by_sequence-403"><span class="linenos">403</span></a>        <span class="c1">#  only the first appearance of the epitope in every chain is retreived</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-404"><a href="#MolecularStructureParser.gen_targets_by_sequence-404"><span class="linenos">404</span></a>        <span class="c1">#  if a chain has more than one epitope, only the first one is returned</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-405"><a href="#MolecularStructureParser.gen_targets_by_sequence-405"><span class="linenos">405</span></a>        <span class="n">target_seq</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;target_sequence&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-406"><a href="#MolecularStructureParser.gen_targets_by_sequence-406"><span class="linenos">406</span></a>        <span class="n">method</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;summary_method&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-407"><a href="#MolecularStructureParser.gen_targets_by_sequence-407"><span class="linenos">407</span></a>        <span class="n">label_name</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-408"><a href="#MolecularStructureParser.gen_targets_by_sequence-408"><span class="linenos">408</span></a>        <span class="n">fluorophore</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-409"><a href="#MolecularStructureParser.gen_targets_by_sequence-409"><span class="linenos">409</span></a>        <span class="n">labeling_efficiency</span> <span class="o">=</span> <span class="n">labelobject</span><span class="o">.</span><span class="n">get_efficiency</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-410"><a href="#MolecularStructureParser.gen_targets_by_sequence-410"><span class="linenos">410</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for sequence: </span><span class="si">{</span><span class="n">target_seq</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-411"><a href="#MolecularStructureParser.gen_targets_by_sequence-411"><span class="linenos">411</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chains_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-412"><a href="#MolecularStructureParser.gen_targets_by_sequence-412"><span class="linenos">412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_chains_sequences</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-413"><a href="#MolecularStructureParser.gen_targets_by_sequence-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-414"><a href="#MolecularStructureParser.gen_targets_by_sequence-414"><span class="linenos">414</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assembly_reference_point</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-415"><a href="#MolecularStructureParser.gen_targets_by_sequence-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-416"><a href="#MolecularStructureParser.gen_targets_by_sequence-416"><span class="linenos">416</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">generate_assemmbly_operations</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-417"><a href="#MolecularStructureParser.gen_targets_by_sequence-417"><span class="linenos">417</span></a>        <span class="n">epitopes_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-418"><a href="#MolecularStructureParser.gen_targets_by_sequence-418"><span class="linenos">418</span></a>        <span class="k">for</span> <span class="n">chains</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">struct</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-419"><a href="#MolecularStructureParser.gen_targets_by_sequence-419"><span class="linenos">419</span></a>            <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-420"><a href="#MolecularStructureParser.gen_targets_by_sequence-420"><span class="linenos">420</span></a>                <span class="n">pps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ppgen</span><span class="o">.</span><span class="n">build_peptides</span><span class="p">(</span><span class="n">chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-421"><a href="#MolecularStructureParser.gen_targets_by_sequence-421"><span class="linenos">421</span></a>                <span class="n">sequence</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-422"><a href="#MolecularStructureParser.gen_targets_by_sequence-422"><span class="linenos">422</span></a>                <span class="k">for</span> <span class="n">peptide</span> <span class="ow">in</span> <span class="n">pps</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-423"><a href="#MolecularStructureParser.gen_targets_by_sequence-423"><span class="linenos">423</span></a>                    <span class="n">sequence</span> <span class="o">+=</span> <span class="n">peptide</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">()</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-424"><a href="#MolecularStructureParser.gen_targets_by_sequence-424"><span class="linenos">424</span></a>                <span class="n">start</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-425"><a href="#MolecularStructureParser.gen_targets_by_sequence-425"><span class="linenos">425</span></a>                <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_seq</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-426"><a href="#MolecularStructureParser.gen_targets_by_sequence-426"><span class="linenos">426</span></a>                <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-427"><a href="#MolecularStructureParser.gen_targets_by_sequence-427"><span class="linenos">427</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-428"><a href="#MolecularStructureParser.gen_targets_by_sequence-428"><span class="linenos">428</span></a>                    <span class="k">for</span> <span class="n">residue</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sequence</span><span class="p">))):</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-429"><a href="#MolecularStructureParser.gen_targets_by_sequence-429"><span class="linenos">429</span></a>                        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-430"><a href="#MolecularStructureParser.gen_targets_by_sequence-430"><span class="linenos">430</span></a>                            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">residue</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-431"><a href="#MolecularStructureParser.gen_targets_by_sequence-431"><span class="linenos">431</span></a>                                <span class="n">coords_chain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">get_vector</span><span class="p">()</span><span class="o">.</span><span class="n">get_array</span><span class="p">())</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-432"><a href="#MolecularStructureParser.gen_targets_by_sequence-432"><span class="linenos">432</span></a>                    <span class="n">coords_chain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-433"><a href="#MolecularStructureParser.gen_targets_by_sequence-433"><span class="linenos">433</span></a>                    <span class="n">epitopes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords_chain</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-434"><a href="#MolecularStructureParser.gen_targets_by_sequence-434"><span class="linenos">434</span></a>        <span class="c1"># print(len(epitopes_list))</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-435"><a href="#MolecularStructureParser.gen_targets_by_sequence-435"><span class="linenos">435</span></a>        <span class="c1"># print(f&quot;Summarizing epitopes location with method {method}&quot;)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-436"><a href="#MolecularStructureParser.gen_targets_by_sequence-436"><span class="linenos">436</span></a>        <span class="n">summarised_epitopes</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">summarize_epitope_atoms</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-437"><a href="#MolecularStructureParser.gen_targets_by_sequence-437"><span class="linenos">437</span></a>            <span class="n">epitopes_list</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-438"><a href="#MolecularStructureParser.gen_targets_by_sequence-438"><span class="linenos">438</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-439"><a href="#MolecularStructureParser.gen_targets_by_sequence-439"><span class="linenos">439</span></a>        <span class="n">colour</span> <span class="o">=</span> <span class="n">set_colorplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-440"><a href="#MolecularStructureParser.gen_targets_by_sequence-440"><span class="linenos">440</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assymetric_defined</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-441"><a href="#MolecularStructureParser.gen_targets_by_sequence-441"><span class="linenos">441</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating symmetry partners for epitopes parsed&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-442"><a href="#MolecularStructureParser.gen_targets_by_sequence-442"><span class="linenos">442</span></a>            <span class="n">epitopes_locations_assembly</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">sym_transforms_numeric_only</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-443"><a href="#MolecularStructureParser.gen_targets_by_sequence-443"><span class="linenos">443</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_operations</span><span class="p">,</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-444"><a href="#MolecularStructureParser.gen_targets_by_sequence-444"><span class="linenos">444</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-445"><a href="#MolecularStructureParser.gen_targets_by_sequence-445"><span class="linenos">445</span></a>                <span class="n">show_transforms_used</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-446"><a href="#MolecularStructureParser.gen_targets_by_sequence-446"><span class="linenos">446</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-447"><a href="#MolecularStructureParser.gen_targets_by_sequence-447"><span class="linenos">447</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-448"><a href="#MolecularStructureParser.gen_targets_by_sequence-448"><span class="linenos">448</span></a>                <span class="n">epitopes_locations_assembly</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-449"><a href="#MolecularStructureParser.gen_targets_by_sequence-449"><span class="linenos">449</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-450"><a href="#MolecularStructureParser.gen_targets_by_sequence-450"><span class="linenos">450</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-451"><a href="#MolecularStructureParser.gen_targets_by_sequence-451"><span class="linenos">451</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-452"><a href="#MolecularStructureParser.gen_targets_by_sequence-452"><span class="linenos">452</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-453"><a href="#MolecularStructureParser.gen_targets_by_sequence-453"><span class="linenos">453</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-454"><a href="#MolecularStructureParser.gen_targets_by_sequence-454"><span class="linenos">454</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-455"><a href="#MolecularStructureParser.gen_targets_by_sequence-455"><span class="linenos">455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapup_label_dictionary</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-456"><a href="#MolecularStructureParser.gen_targets_by_sequence-456"><span class="linenos">456</span></a>                <span class="n">summarised_epitopes</span><span class="p">,</span> <span class="n">labeling_efficiency</span><span class="p">,</span> <span class="n">fluorophore</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-457"><a href="#MolecularStructureParser.gen_targets_by_sequence-457"><span class="linenos">457</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-458"><a href="#MolecularStructureParser.gen_targets_by_sequence-458"><span class="linenos">458</span></a>            <span class="n">label_plotting_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-459"><a href="#MolecularStructureParser.gen_targets_by_sequence-459"><span class="linenos">459</span></a>                <span class="n">plotsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">plotalpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">plotmarker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">plotcolour</span><span class="o">=</span><span class="n">colour</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-460"><a href="#MolecularStructureParser.gen_targets_by_sequence-460"><span class="linenos">460</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.gen_targets_by_sequence-461"><a href="#MolecularStructureParser.gen_targets_by_sequence-461"><span class="linenos">461</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">label_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">label_plotting_params</span>
</span></pre></div>


            <div class="docstring"><p>Generate target locations for the labelling
defined as Binding labeling.</p>

<p>It takes the epitope sequence and search for it in all the chains.
Only considers the first appearance of such sequence.
Keeps the atom coordinates form all residues in the sequence.
Returns a point coordinate calculated from that sequence:
    Default method is coordinate average</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>labelobj</strong>:  instance of the class Label</li>
</ul>
</div>


                            </div>
                            <div id="MolecularStructureParser.gen_Targets" class="classattr">
                                        <input id="MolecularStructureParser.gen_Targets-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_Targets</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labelobj</span><span class="p">:</span> <span class="n"><a href="labels.html#Label">supramolsim.generate.labels.Label</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.gen_Targets-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.gen_Targets"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.gen_Targets-475"><a href="#MolecularStructureParser.gen_Targets-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">gen_Targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularStructureParser.gen_Targets-476"><a href="#MolecularStructureParser.gen_Targets-476"><span class="linenos">476</span></a>        <span class="c1"># call the generator depending on the target type</span>
</span><span id="MolecularStructureParser.gen_Targets-477"><a href="#MolecularStructureParser.gen_Targets-477"><span class="linenos">477</span></a>        <span class="k">if</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Atom_residue&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_Targets-478"><a href="#MolecularStructureParser.gen_Targets-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_atoms</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_Targets-479"><a href="#MolecularStructureParser.gen_Targets-479"><span class="linenos">479</span></a>        <span class="k">elif</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_target_type</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_Targets-480"><a href="#MolecularStructureParser.gen_Targets-480"><span class="linenos">480</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gen_targets_by_sequence</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularStructureParser.gen_Targets-481"><a href="#MolecularStructureParser.gen_Targets-481"><span class="linenos">481</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.gen_Targets-482"><a href="#MolecularStructureParser.gen_Targets-482"><span class="linenos">482</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label type </span><span class="si">{</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_type</span><span class="p">()</span><span class="si">}</span><span class="s2"> is not a valid label&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.get_target_coords" class="classattr">
                                        <input id="MolecularStructureParser.get_target_coords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_target_coords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.get_target_coords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.get_target_coords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.get_target_coords-484"><a href="#MolecularStructureParser.get_target_coords-484"><span class="linenos">484</span></a>    <span class="k">def</span> <span class="nf">get_target_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser.get_target_coords-485"><a href="#MolecularStructureParser.get_target_coords-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.get_target_normals" class="classattr">
                                        <input id="MolecularStructureParser.get_target_normals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_target_normals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.get_target_normals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.get_target_normals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.get_target_normals-487"><a href="#MolecularStructureParser.get_target_normals-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">get_target_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser.get_target_normals-488"><a href="#MolecularStructureParser.get_target_normals-488"><span class="linenos">488</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.get_target_colour" class="classattr">
                                        <input id="MolecularStructureParser.get_target_colour-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_target_colour</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.get_target_colour-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.get_target_colour"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.get_target_colour-490"><a href="#MolecularStructureParser.get_target_colour-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">get_target_colour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="MolecularStructureParser.get_target_colour-491"><a href="#MolecularStructureParser.get_target_colour-491"><span class="linenos">491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">targetid</span><span class="p">][</span><span class="s2">&quot;plotcolour&quot;</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.set_labefficiency" class="classattr">
                                        <input id="MolecularStructureParser.set_labefficiency-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_labefficiency</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">targetname</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">newefficiency</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.set_labefficiency-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.set_labefficiency"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.set_labefficiency-493"><a href="#MolecularStructureParser.set_labefficiency-493"><span class="linenos">493</span></a>    <span class="k">def</span> <span class="nf">set_labefficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">newefficiency</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="MolecularStructureParser.set_labefficiency-494"><a href="#MolecularStructureParser.set_labefficiency-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">targetname</span><span class="p">][</span><span class="s2">&quot;labeling_efficiency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newefficiency</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.show_target_labels" class="classattr">
                                        <input id="MolecularStructureParser.show_target_labels-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_target_labels</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">labelnames</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">with_assembly_atoms</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span>,</span><span class="param">	<span class="n">reference_point</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>,</span><span class="param">	<span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">show_axis</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">with_normals</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.show_target_labels-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.show_target_labels"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.show_target_labels-497"><a href="#MolecularStructureParser.show_target_labels-497"><span class="linenos">497</span></a>    <span class="k">def</span> <span class="nf">show_target_labels</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-498"><a href="#MolecularStructureParser.show_target_labels-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-499"><a href="#MolecularStructureParser.show_target_labels-499"><span class="linenos">499</span></a>        <span class="n">labelnames</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-500"><a href="#MolecularStructureParser.show_target_labels-500"><span class="linenos">500</span></a>        <span class="n">with_assembly_atoms</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-501"><a href="#MolecularStructureParser.show_target_labels-501"><span class="linenos">501</span></a>        <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-502"><a href="#MolecularStructureParser.show_target_labels-502"><span class="linenos">502</span></a>        <span class="n">reference_point</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-503"><a href="#MolecularStructureParser.show_target_labels-503"><span class="linenos">503</span></a>        <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="MolecularStructureParser.show_target_labels-504"><a href="#MolecularStructureParser.show_target_labels-504"><span class="linenos">504</span></a>        <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-505"><a href="#MolecularStructureParser.show_target_labels-505"><span class="linenos">505</span></a>        <span class="n">show_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-506"><a href="#MolecularStructureParser.show_target_labels-506"><span class="linenos">506</span></a>        <span class="n">with_normals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-507"><a href="#MolecularStructureParser.show_target_labels-507"><span class="linenos">507</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser.show_target_labels-508"><a href="#MolecularStructureParser.show_target_labels-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">labelnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-509"><a href="#MolecularStructureParser.show_target_labels-509"><span class="linenos">509</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="MolecularStructureParser.show_target_labels-510"><a href="#MolecularStructureParser.show_target_labels-510"><span class="linenos">510</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-511"><a href="#MolecularStructureParser.show_target_labels-511"><span class="linenos">511</span></a>            <span class="k">for</span> <span class="n">trgt</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="MolecularStructureParser.show_target_labels-512"><a href="#MolecularStructureParser.show_target_labels-512"><span class="linenos">512</span></a>                <span class="k">if</span> <span class="n">with_normals</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-513"><a href="#MolecularStructureParser.show_target_labels-513"><span class="linenos">513</span></a>                    <span class="n">draw_nomral_segments</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-514"><a href="#MolecularStructureParser.show_target_labels-514"><span class="linenos">514</span></a>                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_target_normals</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="MolecularStructureParser.show_target_labels-515"><a href="#MolecularStructureParser.show_target_labels-515"><span class="linenos">515</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-516"><a href="#MolecularStructureParser.show_target_labels-516"><span class="linenos">516</span></a>                        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_colour</span><span class="p">(</span><span class="n">trgt</span><span class="p">)],</span>
</span><span id="MolecularStructureParser.show_target_labels-517"><a href="#MolecularStructureParser.show_target_labels-517"><span class="linenos">517</span></a>                    <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-518"><a href="#MolecularStructureParser.show_target_labels-518"><span class="linenos">518</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-519"><a href="#MolecularStructureParser.show_target_labels-519"><span class="linenos">519</span></a>                    <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-520"><a href="#MolecularStructureParser.show_target_labels-520"><span class="linenos">520</span></a>                        <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-521"><a href="#MolecularStructureParser.show_target_labels-521"><span class="linenos">521</span></a>                        <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-522"><a href="#MolecularStructureParser.show_target_labels-522"><span class="linenos">522</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">get_target_coords</span><span class="p">(</span><span class="n">trgt</span><span class="p">),</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="n">trgt</span><span class="p">]</span>
</span><span id="MolecularStructureParser.show_target_labels-523"><a href="#MolecularStructureParser.show_target_labels-523"><span class="linenos">523</span></a>                        <span class="p">),</span>
</span><span id="MolecularStructureParser.show_target_labels-524"><a href="#MolecularStructureParser.show_target_labels-524"><span class="linenos">524</span></a>                    <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-525"><a href="#MolecularStructureParser.show_target_labels-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="n">with_assembly_atoms</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-526"><a href="#MolecularStructureParser.show_target_labels-526"><span class="linenos">526</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-527"><a href="#MolecularStructureParser.show_target_labels-527"><span class="linenos">527</span></a>            <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-528"><a href="#MolecularStructureParser.show_target_labels-528"><span class="linenos">528</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="MolecularStructureParser.show_target_labels-529"><a href="#MolecularStructureParser.show_target_labels-529"><span class="linenos">529</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-530"><a href="#MolecularStructureParser.show_target_labels-530"><span class="linenos">530</span></a>            <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-531"><a href="#MolecularStructureParser.show_target_labels-531"><span class="linenos">531</span></a>                <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-532"><a href="#MolecularStructureParser.show_target_labels-532"><span class="linenos">532</span></a>                <span class="n">format_coordinates</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-533"><a href="#MolecularStructureParser.show_target_labels-533"><span class="linenos">533</span></a>                    <span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.show_target_labels-534"><a href="#MolecularStructureParser.show_target_labels-534"><span class="linenos">534</span></a>                <span class="p">),</span>
</span><span id="MolecularStructureParser.show_target_labels-535"><a href="#MolecularStructureParser.show_target_labels-535"><span class="linenos">535</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-536"><a href="#MolecularStructureParser.show_target_labels-536"><span class="linenos">536</span></a>        <span class="k">if</span> <span class="n">reference_point</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-537"><a href="#MolecularStructureParser.show_target_labels-537"><span class="linenos">537</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference point at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-538"><a href="#MolecularStructureParser.show_target_labels-538"><span class="linenos">538</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-539"><a href="#MolecularStructureParser.show_target_labels-539"><span class="linenos">539</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="MolecularStructureParser.show_target_labels-540"><a href="#MolecularStructureParser.show_target_labels-540"><span class="linenos">540</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="MolecularStructureParser.show_target_labels-541"><a href="#MolecularStructureParser.show_target_labels-541"><span class="linenos">541</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="MolecularStructureParser.show_target_labels-542"><a href="#MolecularStructureParser.show_target_labels-542"><span class="linenos">542</span></a>                <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-543"><a href="#MolecularStructureParser.show_target_labels-543"><span class="linenos">543</span></a>                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reoriented&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-544"><a href="#MolecularStructureParser.show_target_labels-544"><span class="linenos">544</span></a>                <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-545"><a href="#MolecularStructureParser.show_target_labels-545"><span class="linenos">545</span></a>                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_target_labels-546"><a href="#MolecularStructureParser.show_target_labels-546"><span class="linenos">546</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-547"><a href="#MolecularStructureParser.show_target_labels-547"><span class="linenos">547</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span>
</span><span id="MolecularStructureParser.show_target_labels-548"><a href="#MolecularStructureParser.show_target_labels-548"><span class="linenos">548</span></a>        <span class="k">if</span> <span class="n">show_axis</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-549"><a href="#MolecularStructureParser.show_target_labels-549"><span class="linenos">549</span></a>            <span class="n">draw1nomral_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lenght</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span>
</span><span id="MolecularStructureParser.show_target_labels-550"><a href="#MolecularStructureParser.show_target_labels-550"><span class="linenos">550</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MolecularStructureParser.show_target_labels-551"><a href="#MolecularStructureParser.show_target_labels-551"><span class="linenos">551</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_target_labels-552"><a href="#MolecularStructureParser.show_target_labels-552"><span class="linenos">552</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="MolecularStructureParser.show_target_labels-553"><a href="#MolecularStructureParser.show_target_labels-553"><span class="linenos">553</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.show_target_labels-554"><a href="#MolecularStructureParser.show_target_labels-554"><span class="linenos">554</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_target_labels-555"><a href="#MolecularStructureParser.show_target_labels-555"><span class="linenos">555</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="MolecularStructureParser.show_target_labels-556"><a href="#MolecularStructureParser.show_target_labels-556"><span class="linenos">556</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.show_assembly_atoms" class="classattr">
                                        <input id="MolecularStructureParser.show_assembly_atoms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_assembly_atoms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span>, </span><span class="param"><span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>, </span><span class="param"><span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.show_assembly_atoms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.show_assembly_atoms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.show_assembly_atoms-558"><a href="#MolecularStructureParser.show_assembly_atoms-558"><span class="linenos">558</span></a>    <span class="k">def</span> <span class="nf">show_assembly_atoms</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-559"><a href="#MolecularStructureParser.show_assembly_atoms-559"><span class="linenos">559</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">assembly_fraction</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">view_init</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axesoff</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-560"><a href="#MolecularStructureParser.show_assembly_atoms-560"><span class="linenos">560</span></a>    <span class="p">):</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-561"><a href="#MolecularStructureParser.show_assembly_atoms-561"><span class="linenos">561</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing </span><span class="si">{</span><span class="n">assembly_fraction</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s2">% of the total atoms&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-562"><a href="#MolecularStructureParser.show_assembly_atoms-562"><span class="linenos">562</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-563"><a href="#MolecularStructureParser.show_assembly_atoms-563"><span class="linenos">563</span></a>        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s2">&quot;3d&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-564"><a href="#MolecularStructureParser.show_assembly_atoms-564"><span class="linenos">564</span></a>        <span class="n">atoms_subset</span> <span class="o">=</span> <span class="n">cif_builder</span><span class="o">.</span><span class="n">array_coords_subset</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-565"><a href="#MolecularStructureParser.show_assembly_atoms-565"><span class="linenos">565</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assembly_atoms</span><span class="p">,</span> <span class="n">assembly_fraction</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-566"><a href="#MolecularStructureParser.show_assembly_atoms-566"><span class="linenos">566</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-567"><a href="#MolecularStructureParser.show_assembly_atoms-567"><span class="linenos">567</span></a>        <span class="n">add_ax_scatter</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-568"><a href="#MolecularStructureParser.show_assembly_atoms-568"><span class="linenos">568</span></a>            <span class="n">ax</span><span class="p">,</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-569"><a href="#MolecularStructureParser.show_assembly_atoms-569"><span class="linenos">569</span></a>            <span class="n">format_coordinates</span><span class="p">(</span><span class="n">atoms_subset</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">plotting_params</span><span class="p">[</span><span class="s2">&quot;assemblyatoms&quot;</span><span class="p">]),</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-570"><a href="#MolecularStructureParser.show_assembly_atoms-570"><span class="linenos">570</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-571"><a href="#MolecularStructureParser.show_assembly_atoms-571"><span class="linenos">571</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">azim</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roll</span><span class="o">=</span><span class="n">view_init</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-572"><a href="#MolecularStructureParser.show_assembly_atoms-572"><span class="linenos">572</span></a>        <span class="n">ax</span><span class="o">.</span><span class="n">set_box_aspect</span><span class="p">(</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-573"><a href="#MolecularStructureParser.show_assembly_atoms-573"><span class="linenos">573</span></a>            <span class="p">[</span><span class="n">ub</span> <span class="o">-</span> <span class="n">lb</span> <span class="k">for</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;get_</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2">lim&quot;</span><span class="p">)()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s2">&quot;xyz&quot;</span><span class="p">)]</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-574"><a href="#MolecularStructureParser.show_assembly_atoms-574"><span class="linenos">574</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-575"><a href="#MolecularStructureParser.show_assembly_atoms-575"><span class="linenos">575</span></a>        <span class="k">if</span> <span class="n">axesoff</span><span class="p">:</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-576"><a href="#MolecularStructureParser.show_assembly_atoms-576"><span class="linenos">576</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</span><span id="MolecularStructureParser.show_assembly_atoms-577"><a href="#MolecularStructureParser.show_assembly_atoms-577"><span class="linenos">577</span></a>        <span class="n">fig</span><span class="o">.</span><span class="n">show</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularStructureParser.create_instance_builder" class="classattr">
                                        <input id="MolecularStructureParser.create_instance_builder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">create_instance_builder</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">write</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="n">savingdir</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularStructureParser.create_instance_builder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularStructureParser.create_instance_builder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularStructureParser.create_instance_builder-579"><a href="#MolecularStructureParser.create_instance_builder-579"><span class="linenos">579</span></a>    <span class="k">def</span> <span class="nf">create_instance_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">savingdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MolecularStructureParser.create_instance_builder-580"><a href="#MolecularStructureParser.create_instance_builder-580"><span class="linenos">580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.create_instance_builder-581"><a href="#MolecularStructureParser.create_instance_builder-581"><span class="linenos">581</span></a><span class="sd">        create a dictionary with the information from putative label sites</span>
</span><span id="MolecularStructureParser.create_instance_builder-582"><a href="#MolecularStructureParser.create_instance_builder-582"><span class="linenos">582</span></a><span class="sd">        with their associated normals and general parameters such as axis,</span>
</span><span id="MolecularStructureParser.create_instance_builder-583"><a href="#MolecularStructureParser.create_instance_builder-583"><span class="linenos">583</span></a><span class="sd">        reference point, etc.</span>
</span><span id="MolecularStructureParser.create_instance_builder-584"><a href="#MolecularStructureParser.create_instance_builder-584"><span class="linenos">584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MolecularStructureParser.create_instance_builder-585"><a href="#MolecularStructureParser.create_instance_builder-585"><span class="linenos">585</span></a>        <span class="n">targets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="MolecularStructureParser.create_instance_builder-586"><a href="#MolecularStructureParser.create_instance_builder-586"><span class="linenos">586</span></a>        <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MolecularStructureParser.create_instance_builder-587"><a href="#MolecularStructureParser.create_instance_builder-587"><span class="linenos">587</span></a>            <span class="n">targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
</span><span id="MolecularStructureParser.create_instance_builder-588"><a href="#MolecularStructureParser.create_instance_builder-588"><span class="linenos">588</span></a>                <span class="n">coordinates</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">],</span> <span class="n">normals</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span>
</span><span id="MolecularStructureParser.create_instance_builder-589"><a href="#MolecularStructureParser.create_instance_builder-589"><span class="linenos">589</span></a>            <span class="p">)</span>
</span><span id="MolecularStructureParser.create_instance_builder-590"><a href="#MolecularStructureParser.create_instance_builder-590"><span class="linenos">590</span></a>        <span class="n">instance_builder</span> <span class="o">=</span> <span class="n">builder_format</span><span class="p">(</span>
</span><span id="MolecularStructureParser.create_instance_builder-591"><a href="#MolecularStructureParser.create_instance_builder-591"><span class="linenos">591</span></a>            <span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly_refpt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span>
</span><span id="MolecularStructureParser.create_instance_builder-592"><a href="#MolecularStructureParser.create_instance_builder-592"><span class="linenos">592</span></a>        <span class="p">)</span>
</span><span id="MolecularStructureParser.create_instance_builder-593"><a href="#MolecularStructureParser.create_instance_builder-593"><span class="linenos">593</span></a>        <span class="k">if</span> <span class="n">write</span><span class="p">:</span>
</span><span id="MolecularStructureParser.create_instance_builder-594"><a href="#MolecularStructureParser.create_instance_builder-594"><span class="linenos">594</span></a>            <span class="k">if</span> <span class="n">savingdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularStructureParser.create_instance_builder-595"><a href="#MolecularStructureParser.create_instance_builder-595"><span class="linenos">595</span></a>                <span class="n">savingdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span><span id="MolecularStructureParser.create_instance_builder-596"><a href="#MolecularStructureParser.create_instance_builder-596"><span class="linenos">596</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">savingdir</span> <span class="o">+</span> <span class="s2">&quot;/instance_builder_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>
</span><span id="MolecularStructureParser.create_instance_builder-597"><a href="#MolecularStructureParser.create_instance_builder-597"><span class="linenos">597</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="MolecularStructureParser.create_instance_builder-598"><a href="#MolecularStructureParser.create_instance_builder-598"><span class="linenos">598</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Builder saved in: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularStructureParser.create_instance_builder-599"><a href="#MolecularStructureParser.create_instance_builder-599"><span class="linenos">599</span></a>                <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">instance_builder</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
</span><span id="MolecularStructureParser.create_instance_builder-600"><a href="#MolecularStructureParser.create_instance_builder-600"><span class="linenos">600</span></a>        <span class="k">return</span> <span class="n">instance_builder</span>
</span></pre></div>


            <div class="docstring"><p>create a dictionary with the information from putative label sites
with their associated normals and general parameters such as axis,
reference point, etc.</p>
</div>


                            </div>
                </section>
                <section id="MolecularReplicates">
                            <input id="MolecularReplicates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MolecularReplicates</span><wbr>(<span class="base"><a href="#MolecularStructureParser">MolecularStructureParser</a></span>):

                <label class="view-source-button" for="MolecularReplicates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularReplicates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularReplicates-603"><a href="#MolecularReplicates-603"><span class="linenos">603</span></a><span class="k">class</span> <span class="nc">MolecularReplicates</span><span class="p">(</span><span class="n">MolecularStructureParser</span><span class="p">):</span>
</span><span id="MolecularReplicates-604"><a href="#MolecularReplicates-604"><span class="linenos">604</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbxinfo</span><span class="p">):</span>
</span><span id="MolecularReplicates-605"><a href="#MolecularReplicates-605"><span class="linenos">605</span></a>        <span class="n">MolecularStructureParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MolecularReplicates-606"><a href="#MolecularReplicates-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_parsers</span><span class="p">(</span><span class="n">pdbxinfo</span><span class="p">)</span>
</span><span id="MolecularReplicates-607"><a href="#MolecularReplicates-607"><span class="linenos">607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">replicates</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MolecularReplicates-608"><a href="#MolecularReplicates-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularReplicates-609"><a href="#MolecularReplicates-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MolecularReplicates-610"><a href="#MolecularReplicates-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MolecularReplicates-611"><a href="#MolecularReplicates-611"><span class="linenos">611</span></a>
</span><span id="MolecularReplicates-612"><a href="#MolecularReplicates-612"><span class="linenos">612</span></a>    <span class="k">def</span> <span class="nf">add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularReplicates-613"><a href="#MolecularReplicates-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gen_Targets</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularReplicates-614"><a href="#MolecularReplicates-614"><span class="linenos">614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
</span><span id="MolecularReplicates-615"><a href="#MolecularReplicates-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_plotcolour</span><span class="p">()</span>
</span><span id="MolecularReplicates-616"><a href="#MolecularReplicates-616"><span class="linenos">616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span><span id="MolecularReplicates-617"><a href="#MolecularReplicates-617"><span class="linenos">617</span></a>
</span><span id="MolecularReplicates-618"><a href="#MolecularReplicates-618"><span class="linenos">618</span></a>    <span class="k">def</span> <span class="nf">assign_normals2targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MolecularReplicates-619"><a href="#MolecularReplicates-619"><span class="linenos">619</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assigning normals to targets with method: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularReplicates-620"><a href="#MolecularReplicates-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularReplicates-621"><a href="#MolecularReplicates-621"><span class="linenos">621</span></a>            <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MolecularReplicates-622"><a href="#MolecularReplicates-622"><span class="linenos">622</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="MolecularReplicates-623"><a href="#MolecularReplicates-623"><span class="linenos">623</span></a>                    <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span>
</span><span id="MolecularReplicates-624"><a href="#MolecularReplicates-624"><span class="linenos">624</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="MolecularReplicates-625"><a href="#MolecularReplicates-625"><span class="linenos">625</span></a>                    <span class="p">)</span>
</span><span id="MolecularReplicates-626"><a href="#MolecularReplicates-626"><span class="linenos">626</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span><span id="MolecularReplicates-627"><a href="#MolecularReplicates-627"><span class="linenos">627</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularReplicates-628"><a href="#MolecularReplicates-628"><span class="linenos">628</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="MolecularReplicates-629"><a href="#MolecularReplicates-629"><span class="linenos">629</span></a>                <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span>
</span><span id="MolecularReplicates-630"><a href="#MolecularReplicates-630"><span class="linenos">630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span></pre></div>


    

                            <div id="MolecularReplicates.__init__" class="classattr">
                                        <input id="MolecularReplicates.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MolecularReplicates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pdbxinfo</span></span>)</span>

                <label class="view-source-button" for="MolecularReplicates.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularReplicates.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularReplicates.__init__-604"><a href="#MolecularReplicates.__init__-604"><span class="linenos">604</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdbxinfo</span><span class="p">):</span>
</span><span id="MolecularReplicates.__init__-605"><a href="#MolecularReplicates.__init__-605"><span class="linenos">605</span></a>        <span class="n">MolecularStructureParser</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MolecularReplicates.__init__-606"><a href="#MolecularReplicates.__init__-606"><span class="linenos">606</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">initialise_parsers</span><span class="p">(</span><span class="n">pdbxinfo</span><span class="p">)</span>
</span><span id="MolecularReplicates.__init__-607"><a href="#MolecularReplicates.__init__-607"><span class="linenos">607</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">replicates</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MolecularReplicates.__init__-608"><a href="#MolecularReplicates.__init__-608"><span class="linenos">608</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MolecularReplicates.__init__-609"><a href="#MolecularReplicates.__init__-609"><span class="linenos">609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MolecularReplicates.__init__-610"><a href="#MolecularReplicates.__init__-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularReplicates.replicates" class="classattr">
                                <div class="attr variable">
            <span class="name">replicates</span>

        
    </div>
    <a class="headerlink" href="#MolecularReplicates.replicates"></a>
    
    

                            </div>
                            <div id="MolecularReplicates.label_names" class="classattr">
                                <div class="attr variable">
            <span class="name">label_names</span>

        
    </div>
    <a class="headerlink" href="#MolecularReplicates.label_names"></a>
    
    

                            </div>
                            <div id="MolecularReplicates.plotcolours" class="classattr">
                                <div class="attr variable">
            <span class="name">plotcolours</span>

        
    </div>
    <a class="headerlink" href="#MolecularReplicates.plotcolours"></a>
    
    

                            </div>
                            <div id="MolecularReplicates.label_fluorophore" class="classattr">
                                <div class="attr variable">
            <span class="name">label_fluorophore</span>

        
    </div>
    <a class="headerlink" href="#MolecularReplicates.label_fluorophore"></a>
    
    

                            </div>
                            <div id="MolecularReplicates.add_label" class="classattr">
                                        <input id="MolecularReplicates.add_label-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_label</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">labelobj</span><span class="p">:</span> <span class="n"><a href="labels.html#Label">supramolsim.generate.labels.Label</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularReplicates.add_label-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularReplicates.add_label"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularReplicates.add_label-612"><a href="#MolecularReplicates.add_label-612"><span class="linenos">612</span></a>    <span class="k">def</span> <span class="nf">add_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labelobj</span><span class="p">:</span> <span class="n">Label</span><span class="p">):</span>
</span><span id="MolecularReplicates.add_label-613"><a href="#MolecularReplicates.add_label-613"><span class="linenos">613</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gen_Targets</span><span class="p">(</span><span class="n">labelobj</span><span class="p">)</span>
</span><span id="MolecularReplicates.add_label-614"><a href="#MolecularReplicates.add_label-614"><span class="linenos">614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
</span><span id="MolecularReplicates.add_label-615"><a href="#MolecularReplicates.add_label-615"><span class="linenos">615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">plotcolours</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_plotcolour</span><span class="p">()</span>
</span><span id="MolecularReplicates.add_label-616"><a href="#MolecularReplicates.add_label-616"><span class="linenos">616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">label_fluorophore</span><span class="p">[</span><span class="n">labelobj</span><span class="o">.</span><span class="n">get_name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">labelobj</span><span class="o">.</span><span class="n">get_fluorophore</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="MolecularReplicates.assign_normals2targets" class="classattr">
                                        <input id="MolecularReplicates.assign_normals2targets-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assign_normals2targets</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;scaling&#39;</span>, </span><span class="param"><span class="n">target</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MolecularReplicates.assign_normals2targets-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MolecularReplicates.assign_normals2targets"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MolecularReplicates.assign_normals2targets-618"><a href="#MolecularReplicates.assign_normals2targets-618"><span class="linenos">618</span></a>    <span class="k">def</span> <span class="nf">assign_normals2targets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scaling&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MolecularReplicates.assign_normals2targets-619"><a href="#MolecularReplicates.assign_normals2targets-619"><span class="linenos">619</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assigning normals to targets with method: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MolecularReplicates.assign_normals2targets-620"><a href="#MolecularReplicates.assign_normals2targets-620"><span class="linenos">620</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MolecularReplicates.assign_normals2targets-621"><a href="#MolecularReplicates.assign_normals2targets-621"><span class="linenos">621</span></a>            <span class="k">for</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MolecularReplicates.assign_normals2targets-622"><a href="#MolecularReplicates.assign_normals2targets-622"><span class="linenos">622</span></a>                <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="MolecularReplicates.assign_normals2targets-623"><a href="#MolecularReplicates.assign_normals2targets-623"><span class="linenos">623</span></a>                    <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span>
</span><span id="MolecularReplicates.assign_normals2targets-624"><a href="#MolecularReplicates.assign_normals2targets-624"><span class="linenos">624</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">]</span>
</span><span id="MolecularReplicates.assign_normals2targets-625"><a href="#MolecularReplicates.assign_normals2targets-625"><span class="linenos">625</span></a>                    <span class="p">)</span>
</span><span id="MolecularReplicates.assign_normals2targets-626"><a href="#MolecularReplicates.assign_normals2targets-626"><span class="linenos">626</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target_name</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span><span id="MolecularReplicates.assign_normals2targets-627"><a href="#MolecularReplicates.assign_normals2targets-627"><span class="linenos">627</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MolecularReplicates.assign_normals2targets-628"><a href="#MolecularReplicates.assign_normals2targets-628"><span class="linenos">628</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;scaling&quot;</span><span class="p">:</span>
</span><span id="MolecularReplicates.assign_normals2targets-629"><a href="#MolecularReplicates.assign_normals2targets-629"><span class="linenos">629</span></a>                <span class="n">normals</span> <span class="o">=</span> <span class="n">normals_by_scaling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;coordinates&quot;</span><span class="p">])</span>
</span><span id="MolecularReplicates.assign_normals2targets-630"><a href="#MolecularReplicates.assign_normals2targets-630"><span class="linenos">630</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">label_targets</span><span class="p">[</span><span class="n">target</span><span class="p">][</span><span class="s2">&quot;normals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MolecularStructureParser">MolecularStructureParser</a></dt>
                                <dd id="MolecularReplicates.id" class="variable"><a href="#MolecularStructureParser.id">id</a></dd>
                <dd id="MolecularReplicates.chain_builder" class="variable"><a href="#MolecularStructureParser.chain_builder">chain_builder</a></dd>
                <dd id="MolecularReplicates.ch_builder_max_dist" class="variable"><a href="#MolecularStructureParser.ch_builder_max_dist">ch_builder_max_dist</a></dd>
                <dd id="MolecularReplicates.ppgen" class="variable"><a href="#MolecularStructureParser.ppgen">ppgen</a></dd>
                <dd id="MolecularReplicates.CIFdictionary" class="variable"><a href="#MolecularStructureParser.CIFdictionary">CIFdictionary</a></dd>
                <dd id="MolecularReplicates.assembly_operations" class="variable"><a href="#MolecularStructureParser.assembly_operations">assembly_operations</a></dd>
                <dd id="MolecularReplicates.chains_dict" class="variable"><a href="#MolecularStructureParser.chains_dict">chains_dict</a></dd>
                <dd id="MolecularReplicates.assembly_refpt" class="variable"><a href="#MolecularStructureParser.assembly_refpt">assembly_refpt</a></dd>
                <dd id="MolecularReplicates.assembly_atoms" class="variable"><a href="#MolecularStructureParser.assembly_atoms">assembly_atoms</a></dd>
                <dd id="MolecularReplicates.num_assembly_atoms" class="variable"><a href="#MolecularStructureParser.num_assembly_atoms">num_assembly_atoms</a></dd>
                <dd id="MolecularReplicates.store_atoms_assembly" class="variable"><a href="#MolecularStructureParser.store_atoms_assembly">store_atoms_assembly</a></dd>
                <dd id="MolecularReplicates.assymetric_defined" class="variable"><a href="#MolecularStructureParser.assymetric_defined">assymetric_defined</a></dd>
                <dd id="MolecularReplicates.label_targets" class="variable"><a href="#MolecularStructureParser.label_targets">label_targets</a></dd>
                <dd id="MolecularReplicates.label_normals" class="variable"><a href="#MolecularStructureParser.label_normals">label_normals</a></dd>
                <dd id="MolecularReplicates.plotting_params" class="variable"><a href="#MolecularStructureParser.plotting_params">plotting_params</a></dd>
                <dd id="MolecularReplicates.scale" class="variable"><a href="#MolecularStructureParser.scale">scale</a></dd>
                <dd id="MolecularReplicates.axis" class="variable"><a href="#MolecularStructureParser.axis">axis</a></dd>
                <dd id="MolecularReplicates.initialise_parsers" class="function"><a href="#MolecularStructureParser.initialise_parsers">initialise_parsers</a></dd>
                <dd id="MolecularReplicates.build_structure" class="function"><a href="#MolecularStructureParser.build_structure">build_structure</a></dd>
                <dd id="MolecularReplicates.generate_MMCIF_dictionary" class="function"><a href="#MolecularStructureParser.generate_MMCIF_dictionary">generate_MMCIF_dictionary</a></dd>
                <dd id="MolecularReplicates.get_atoms_infile" class="function"><a href="#MolecularStructureParser.get_atoms_infile">get_atoms_infile</a></dd>
                <dd id="MolecularReplicates.generate_chains_sequences" class="function"><a href="#MolecularStructureParser.generate_chains_sequences">generate_chains_sequences</a></dd>
                <dd id="MolecularReplicates.generate_assemmbly_operations" class="function"><a href="#MolecularStructureParser.generate_assemmbly_operations">generate_assemmbly_operations</a></dd>
                <dd id="MolecularReplicates.generate_assembly_reference_point" class="function"><a href="#MolecularStructureParser.generate_assembly_reference_point">generate_assembly_reference_point</a></dd>
                <dd id="MolecularReplicates.set_axis_from_point" class="function"><a href="#MolecularStructureParser.set_axis_from_point">set_axis_from_point</a></dd>
                <dd id="MolecularReplicates.set_axis_with_vector" class="function"><a href="#MolecularStructureParser.set_axis_with_vector">set_axis_with_vector</a></dd>
                <dd id="MolecularReplicates.get_atom_res_chains_assembly" class="function"><a href="#MolecularStructureParser.get_atom_res_chains_assembly">get_atom_res_chains_assembly</a></dd>
                <dd id="MolecularReplicates.gen_targets_by_atoms" class="function"><a href="#MolecularStructureParser.gen_targets_by_atoms">gen_targets_by_atoms</a></dd>
                <dd id="MolecularReplicates.gen_targets_by_sequence" class="function"><a href="#MolecularStructureParser.gen_targets_by_sequence">gen_targets_by_sequence</a></dd>
                <dd id="MolecularReplicates.gen_Targets" class="function"><a href="#MolecularStructureParser.gen_Targets">gen_Targets</a></dd>
                <dd id="MolecularReplicates.get_target_coords" class="function"><a href="#MolecularStructureParser.get_target_coords">get_target_coords</a></dd>
                <dd id="MolecularReplicates.get_target_normals" class="function"><a href="#MolecularStructureParser.get_target_normals">get_target_normals</a></dd>
                <dd id="MolecularReplicates.get_target_colour" class="function"><a href="#MolecularStructureParser.get_target_colour">get_target_colour</a></dd>
                <dd id="MolecularReplicates.set_labefficiency" class="function"><a href="#MolecularStructureParser.set_labefficiency">set_labefficiency</a></dd>
                <dd id="MolecularReplicates.show_target_labels" class="function"><a href="#MolecularStructureParser.show_target_labels">show_target_labels</a></dd>
                <dd id="MolecularReplicates.show_assembly_atoms" class="function"><a href="#MolecularStructureParser.show_assembly_atoms">show_assembly_atoms</a></dd>
                <dd id="MolecularReplicates.create_instance_builder" class="function"><a href="#MolecularStructureParser.create_instance_builder">create_instance_builder</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="build_structure_cif">
                            <input id="build_structure_cif-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_structure_cif</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">cif_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">struct_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">cif_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">format_type</span><span class="o">=</span><span class="s1">&#39;CIF&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="build_structure_cif-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#build_structure_cif"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="build_structure_cif-633"><a href="#build_structure_cif-633"><span class="linenos">633</span></a><span class="k">def</span> <span class="nf">build_structure_cif</span><span class="p">(</span>
</span><span id="build_structure_cif-634"><a href="#build_structure_cif-634"><span class="linenos">634</span></a>    <span class="n">cif_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">struct_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cif_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">format_type</span><span class="o">=</span><span class="s2">&quot;CIF&quot;</span>
</span><span id="build_structure_cif-635"><a href="#build_structure_cif-635"><span class="linenos">635</span></a><span class="p">):</span>
</span><span id="build_structure_cif-636"><a href="#build_structure_cif-636"><span class="linenos">636</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="build_structure_cif-637"><a href="#build_structure_cif-637"><span class="linenos">637</span></a><span class="sd">    Load and parse PDB/CIF file and build structure object.</span>
</span><span id="build_structure_cif-638"><a href="#build_structure_cif-638"><span class="linenos">638</span></a><span class="sd">    This generates the minimal object containing all atoms and</span>
</span><span id="build_structure_cif-639"><a href="#build_structure_cif-639"><span class="linenos">639</span></a><span class="sd">    associated infomration parsed ready to be accessed when labelling</span>
</span><span id="build_structure_cif-640"><a href="#build_structure_cif-640"><span class="linenos">640</span></a><span class="sd">    and displaying structure.</span>
</span><span id="build_structure_cif-641"><a href="#build_structure_cif-641"><span class="linenos">641</span></a>
</span><span id="build_structure_cif-642"><a href="#build_structure_cif-642"><span class="linenos">642</span></a><span class="sd">    Input:</span>
</span><span id="build_structure_cif-643"><a href="#build_structure_cif-643"><span class="linenos">643</span></a><span class="sd">        (string): absolute path of CIF</span>
</span><span id="build_structure_cif-644"><a href="#build_structure_cif-644"><span class="linenos">644</span></a><span class="sd">    Output:</span>
</span><span id="build_structure_cif-645"><a href="#build_structure_cif-645"><span class="linenos">645</span></a><span class="sd">        (MolecularReplicates) Structure object</span>
</span><span id="build_structure_cif-646"><a href="#build_structure_cif-646"><span class="linenos">646</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="build_structure_cif-647"><a href="#build_structure_cif-647"><span class="linenos">647</span></a>    <span class="n">structure_dictionary</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="build_structure_cif-648"><a href="#build_structure_cif-648"><span class="linenos">648</span></a>        <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">cif_file</span><span class="p">,</span>
</span><span id="build_structure_cif-649"><a href="#build_structure_cif-649"><span class="linenos">649</span></a>        <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">struct_title</span><span class="p">,</span>
</span><span id="build_structure_cif-650"><a href="#build_structure_cif-650"><span class="linenos">650</span></a>        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">format_type</span><span class="p">,</span>
</span><span id="build_structure_cif-651"><a href="#build_structure_cif-651"><span class="linenos">651</span></a>        <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="n">cif_id</span><span class="p">,</span>
</span><span id="build_structure_cif-652"><a href="#build_structure_cif-652"><span class="linenos">652</span></a>    <span class="p">}</span>
</span><span id="build_structure_cif-653"><a href="#build_structure_cif-653"><span class="linenos">653</span></a>    <span class="n">Molecularstructure</span> <span class="o">=</span> <span class="n">MolecularReplicates</span><span class="p">(</span><span class="n">structure_dictionary</span><span class="p">)</span>
</span><span id="build_structure_cif-654"><a href="#build_structure_cif-654"><span class="linenos">654</span></a>    <span class="n">Molecularstructure</span><span class="o">.</span><span class="n">build_structure</span><span class="p">()</span>
</span><span id="build_structure_cif-655"><a href="#build_structure_cif-655"><span class="linenos">655</span></a>    <span class="k">return</span> <span class="n">Molecularstructure</span>
</span></pre></div>


            <div class="docstring"><p>Load and parse PDB/CIF file and build structure object.
This generates the minimal object containing all atoms and
associated infomration parsed ready to be accessed when labelling
and displaying structure.</p>

<p>Input:
    (string): absolute path of CIF
Output:
    (MolecularReplicates) Structure object</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>